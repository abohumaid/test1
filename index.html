<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfanan-Supplements</title>
    <link rel="icon" href="icon1.png" type="image/svg+xml">
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase Analytics (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@500;700&display=swap');

        body {
            margin: 0;
            font-family: 'Teko', Arial, sans-serif;
            background: #faf9f6;
            color: #222;
            min-height: 100vh;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            padding: 0px;
            height: 54px;
            box-shadow: 0 2px 8px #e0e0e0;
        }

        #headerBar {
            background: #fff !important;
            box-shadow: 0 2px 8px #e0e0e0 !important;
        }

        .navbar .logo {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: #784fe7;
            display: flex;
            align-items: center;
            padding: 10px;
        }

        .navbar ul {
            display: flex;
            gap: 1px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .navbar li {
            cursor: pointer;
            font-size: 2.1rem;
            font-weight: bold;
            transition: color 0.2s;
            position: relative;
            padding: 0 5px 2px 5px;
        }

        .navbar li:hover,
        .navbar li.active {
            color: #784fe7;
        }

        .navbar li::after {
            content: '';
            display: block;
            margin: 0 auto;
            margin-top: 4px;
            width: 28px;
            height: 4px;
            border-radius: 2px;
            background: transparent;
            transition: background 0.2s, width 0.2s;
        }

        .navbar li.active::after,
        .navbar li:hover::after {
            background: #784fe733;
            width: 32px;
        }

        #searchBarContainer {
            margin-bottom: 0 !important;
        }

        #searchInput::placeholder {
            color: #bbb;
            opacity: 1;
        }

        #searchInput {
            background: #fff;
            color: #784fe7;
            border: 1.5px solid #784fe7;
            box-shadow: 0 2px 8px #784fe733;
            transition: box-shadow 0.2s, border 0.2s;
            margin-left: 10px;
        }

        #searchInput:focus {
            outline: none;
            border: 1.5px solid #784fe7;
            box-shadow: 0 0 0 2px #784fe733;
        }

        .container {
            max-width: 1100px;
            margin: 16px auto 0 auto;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px #e0e0e0;
            border: 1px solid #784fe733;
        }

        .admin-login-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .admin-login-box {
            background: #fff;
            padding: 32px 28px;
            border-radius: 10px;
            box-shadow: 0 2px 16px #e0e0e0;
            min-width: 320px;
            text-align: center;
        }

        .admin-login-box h2 {
            margin-bottom: 18px;
            color: #784fe7;
            font-size: 2rem;
        }

        .admin-login-box input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1.1rem;
        }

        /* --- ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿ≥ŸÅŸÑŸä ÿßŸÑŸÖÿ∑Ÿàÿ± --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.1);
            z-index: 10000;
            border-top: 1px solid #eee;
        }

        .bottom-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            gap: 2px;
        }

        .bottom-nav-item svg {
            width: 28px;
            height: 28px;
            fill: none;
            stroke: currentColor;
            stroke-width: 1.5;
            transition: transform 0.2s;
        }

        .bottom-nav-item span {
            font-size: 0.85rem;
            font-weight: 500;
            display: block;
        }

        .bottom-nav-item:hover {
            color: #784fe7;
            background: rgba(120, 79, 231, 0.05);
            border-radius: 12px;
        }

        .bottom-nav-item:hover svg {
            transform: scale(1.15);
        }

        .bottom-nav-item.active {
            color: #784fe7;
        }

        .bottom-nav-item.active svg {
            stroke-width: 2.5;
            transform: translateY(-3px);
        }

        .bottom-nav-item.active span {
            font-weight: 700;
        }

        .nav-badge {
            position: absolute;
            top: 4px;
            right: 25%;
            background: #ff4444;
            color: #fff;
            font-size: 0.7rem;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            font-weight: bold;
            z-index: 2;
        }

        /* ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿ≥ÿßŸÅÿ© ŸÅŸä ÿ≥ŸÅŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ŸÑÿ™ÿ¨ŸÜÿ® ÿ™ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÖÿπ ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± */
        body {
            padding-bottom: 80px;
        }

        .admin-login-box button {
            background: #a1589e;
            color: #222;
            border: none;
            padding: 10px 30px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .admin-login-box .error {
            color: #ff4444;
            font-size: 1rem;
            margin-top: 8px;
        }

        /* --- Professional Admin Dashboard --- */
        .admin-dash-container {
            display: flex;
            min-height: 80vh;
            background: #faf9f6;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            margin-top: 10px;
        }

        .dash-sidebar {
            width: 240px;
            background: #232323;
            color: #fff;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }

        .dash-sidebar-item {
            padding: 14px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            color: #aaa;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }

        .dash-sidebar-item:hover {
            background: #2d2d2d;
            color: #fff;
        }

        .dash-sidebar-item.active {
            background: #2d2d2d;
            color: #784fe7;
            border-left-color: #784fe7;
        }

        .dash-sidebar-item svg {
            width: 20px;
            height: 20px;
        }

        .dash-main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: #fff;
        }

        .dash-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #eee;
        }

        .dash-header h2 {
            margin: 0;
            color: #333;
            font-size: 1.6rem;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
            border: 1px solid #eee;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .label {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #784fe7;
        }

        /* Responsive Dashboard */
        @media (max-width: 768px) {
            .admin-dash-container {
                flex-direction: column;
            }

            .dash-sidebar {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                padding: 10px 0;
            }

            .dash-sidebar-item {
                padding: 10px 16px;
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .dash-sidebar-item.active {
                border-bottom-color: #784fe7;
            }
        }

        .admin-panel {
            text-align: right;
        }

        .admin-panel h2 {
            color: #784fe7;
            margin-bottom: 18px;
        }

        .add-product-btn {
            background: #784fe7 !important;
            color: #fff !important;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 18px;
        }

        .product-form {
            background: #ecf1eb;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 18px 20px;
            margin-bottom: 24px;
            direction: rtl;
        }

        .product-form label {
            display: block;
            margin: 10px 0 4px 0;
            font-size: 1.1rem;
        }

        .product-form input,
        .product-form textarea,
        .product-form select {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: none;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .product-form input[type="file"] {
            background: #fff;
            color: #222;
        }

        .product-form button {
            background: #a1589e;
            color: #222;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .products-list {
            margin-top: 30px;
        }

        .product-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 12px #e0e0e0;
            border: 1px solid #eec9d2;
            padding: 10px 20px;
            margin-bottom: 12px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            position: relative;
        }

        .product-card img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #eec9d2;
            background: #fff;
        }

        .product-info {
            flex: 1;
        }

        .product-title {
            font-size: 1.5rem;
            color: #5a4e7c;
            margin-bottom: 6px;
        }

        .product-desc {
            font-size: 1.1rem;
            margin-bottom: 2px;
        }

        .product-type {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 0;
        }

        .product-prices {
            font-size: 1.5rem;
            margin-bottom: 6px;
            font-weight: bold;
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-start;
            align-items: center;
            gap: 12px;
        }

        .product-prices del {
            color: #b45d8c;
            margin-right: 8px;
            margin-left: 0;
        }

        .product-actions {
            display: flex;
            flex-direction: row;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-top: 18px;
            position: static;
        }

        .product-actions button {
            background: none;
            color: #a1589e;
            border: none;
            border-radius: 5px;
            padding: 4px 6px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
        }

        .product-actions button:hover {
            color: #fff;
            background: #a1589e;
        }

        .section-title {
            font-size: 2rem;
            color: #5a4e7c;
            margin-bottom: 18px;
            text-align: center;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
        }

        .products-grid .product-card {
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            opacity: 0;
            transform: translateY(30px);
            animation: productFadeIn 0.35s cubic-bezier(.36, .07, .19, .97) forwards;
            animation-delay: var(--fade-delay, 0ms);
        }

        @keyframes productFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .products-grid .product-card img,
        .products-grid .img-slider {
            width: 180px !important;
            height: 180px !important;
            max-width: 100%;
            max-height: 100%;
        }

        @media (max-width: 700px) {
            .container {
                padding: 8px;
            }

            .navbar {
                flex-direction: column;
                height: auto;
                padding: 0 4px;
            }

            .navbar {
                font-size: 1.5rem;
            }

            .logo {
                font-size: 2.3rem !important;
                color: #5a4e7c !important;
            }

            .navbar ul {
                gap: 6px;
            }

            .navbar li {
                font-size: 1.5rem !important;
                padding: 0 3px 2px 3px;
            }

            #searchInput {
                font-size: 1.3rem !important;
            }
        }

        /* Splash Screen Animations */
        @keyframes shake {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }

            10% {
                transform: translate(-20px, 0) rotate(-10deg);
            }

            20% {
                transform: translate(20px, 0) rotate(10deg);
            }

            30% {
                transform: translate(-20px, 0) rotate(-10deg);
            }

            40% {
                transform: translate(20px, 0) rotate(10deg);
            }

            50% {
                transform: translate(-20px, 0) rotate(-10deg);
            }

            60% {
                transform: translate(20px, 0) rotate(10deg);
            }

            70% {
                transform: translate(-20px, 0) rotate(-10deg);
            }

            80% {
                transform: translate(-20px, 0) rotate(-10deg);
            }

            90% {
                transform: translate(20px, 0) rotate(10deg);
            }

            100% {
                transform: translate(0, 0) rotate(0deg);
            }
        }

        @keyframes dropDown {
            0% {
                transform: translateY(0);
            }

            80% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(100vh);
            }
        }

        @keyframes shakeCart {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }

            20% {
                transform: translate(-4px, 0) rotate(-8deg);
            }

            40% {
                transform: translate(4px, 0) rotate(8deg);
            }

            60% {
                transform: translate(-4px, 0) rotate(-8deg);
            }

            80% {
                transform: translate(4px, 0) rotate(8deg);
            }

            100% {
                transform: translate(0, 0) rotate(0deg);
            }
        }

        .shake-cart {
            animation: shakeCart 0.6s cubic-bezier(.36, .07, .19, .97) both;
        }

        .add-to-cart-msg {
            position: fixed;
            top: 80px;
            right: 30px;
            background: #f346f3;
            color: #fff;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 14px 28px;
            border-radius: 10px;
            box-shadow: 0 2px 12px #e0e0e0;
            z-index: 99999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.3s;
        }

        .add-to-cart-msg.show {
            opacity: 1;
            transform: translateY(0);
        }

        #cartBtn svg circle {
            fill: #a1589e !important;
        }

        #cartBtn svg path {
            fill: #784fe7 !important;
        }

        #favoritesBtn svg path {
            fill: #a1589e !important;
        }

        /* ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑÿ£ÿØŸÖŸÜ ŸÅŸä ÿßŸÑŸÜÿßÿ® ÿ®ÿßÿ± ÿ™ŸÖÿßŸÖŸãÿß */
        li#adminBtn[data-section="admin"] {
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            display: inline-block !important;
        }

        /* ÿ•ÿÆŸÅÿßÿ° ŸÜÿµ ŸÜŸàÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ (man, woman, offers) ŸÅŸä ŸÉÿßÿ±ÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ */
        .product-card .product-type {
            font-size: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            line-height: 0 !important;
        }

        .add-to-cart-btn {
            margin-top: 2px !important;
            background: #a1589e !important;
            color: #222 !important;
            border: none;
        }

        .add-to-cart-btn:hover {
            background: #784fe7 !important;
            color: #fff !important;
        }

        .add-product-btn,
        .order-status-select {
            background: #e6b400 !important;
            color: #fff !important;
            border: none;
        }

        .add-product-btn:hover,
        .order-status-select:hover {
            background: #fffbe6 !important;
            color: #b38f00 !important;
        }

        /* ÿ≠ÿØŸàÿØ ÿßŸÑŸÇŸÑÿ® ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä ÿØÿßŸÉŸÜ */
        #favoritesBtn svg path {
            stroke: rgb(100, 68, 109) !important;
        }

        /* ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ŸÅŸàŸÇ ÿßŸÑŸÇŸÑÿ® ÿ£ÿ®Ÿäÿ∂ ÿ®ÿÆŸÑŸÅŸäÿ© ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä ŸÅÿßÿ™ÿ≠ */
        #favoritesCount {
            background: #ff4444 !important;
            color: #fff !important;
        }

        @keyframes marquee {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ® ÿ≠ÿ≥ÿ® ÿßŸÑÿ≠ÿßŸÑÿ© */
        .order-status-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 6px 28px 6px 8px !important;
            border-radius: 8px !important;
            font-weight: bold !important;
            border: 2px solid #784fe7 !important;
            background: #784fe7 !important;
            color: #222 !important;
            transition: background 0.2s, color 0.2s, border 0.2s;
            cursor: pointer;
            min-width: 120px;
            text-align: center;
        }

        .order-status-select.delivered {
            background: #25d366 !important;
            color: #fff !important;
            border-color: #25d366 !important;
        }

        .order-status-select.cancelled {
            background: #ff4444 !important;
            color: #fff !important;
            border-color: #ff4444 !important;
        }

        .order-status-select.pending {
            background: #784fe7 !important;
            color: #222 !important;
            border-color: #784fe7 !important;
        }

        /* --- ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¥ŸÉŸÑ ŸÅŸàÿ±ŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸÖÿπ Floating Label --- */
        .order-form-modern {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 22px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px #e0e0e0;
            padding: 32px 24px 24px 24px;
            position: relative;
        }

        .order-form-modern .form-group {
            direction: rtl;
            width: 100%;
            position: relative;
            margin-bottom: 0;
        }

        .order-form-modern input,
        .order-form-modern textarea {
            box-sizing: border-box;
            width: 100%;
            padding: 18px 12px 10px 12px;
            border: 1.5px solid #eec9d2;
            border-radius: 8px;
            font-size: 1.15rem;
            background: #faf9f6;
            color: #5a4e7c;
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px #eec9d2;
        }

        .order-form-modern input:focus,
        .order-form-modern textarea:focus {
            border: 1.5px solid #b9b4e7;
            box-shadow: 0 0 0 2px #b9b4e733;
        }

        .order-form-modern label {
            position: absolute;

            top: 9px;
            right: 15px;
            background: transparent;
            color: #b9b4e7;
            font-size: 1.1rem;
            pointer-events: none;
            transition: 0.2s cubic-bezier(.36, .07, .19, .97);
            padding: 0 4px;
            z-index: 2;
        }

        .order-form-modern input:not(:placeholder-shown)+label,
        .order-form-modern input:focus+label,
        .order-form-modern textarea:not(:placeholder-shown)+label,
        .order-form-modern textarea:focus+label {
            top: -10px;
            right: 2px;
            font-size: 0.95rem;
            color: #a1589e;
            background: #fff;
            padding: 0 6px;
            border-radius: 6px;
        }

        .order-form-modern textarea {
            min-height: 60px;
            resize: vertical;
        }

        .order-form-modern button[type="submit"] {
            background: linear-gradient(90deg, #784fe7 0%, #a1589e 100%);
            color: #222;
            font-weight: bold;
            padding: 14px 0;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            margin-top: 10px;
            box-shadow: 0 2px 8px #eec9d2;
            transition: background 0.2s, color 0.2s;
        }

        .order-form-modern button[type="submit"]:hover {
            background: linear-gradient(90deg, #a1589e 0%, #784fe7 100%);
            color: #fff;
        }

        .order-form-modern .error-msg {
            color: #ff4444;
            font-size: 1rem;
            margin-top: 2px;
            margin-bottom: -10px;
            min-height: 18px;
        }

        .order-form-modern .success-msg {
            color: #25d366;
            font-size: 1rem;
            margin-top: 2px;
            margin-bottom: -10px;
            min-height: 18px;
        }

        .order-form-modern #orderTotalBox {
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* ÿ≥ŸáŸÖ ÿßŸÑÿØÿ±Ÿàÿ® ŸÖŸÜŸäŸà ŸÅŸä ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© */
        .dropdown-arrow {
            position: absolute;
            left: 15px;
            top: 25px;
            color: #b9b4e7;
            pointer-events: none;
            transition: transform 0.3s cubic-bezier(.36, .07, .19, .97);
            z-index: 5;
        }

        #governorateInput:focus~.dropdown-arrow,
        #governorateInput:not(:placeholder-shown)~.dropdown-arrow {
            transform: rotate(180deg);
            color: #a1589e;
        }

        #governorateInput {
            padding-left: 40px !important;
        }
    </style>
    <style>
        /* ŸÑŸÖÿπÿ© ŸÖÿ™ÿ≠ÿ±ŸÉÿ© ÿπŸÑŸâ ÿπŸÜÿßÿµÿ± ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿπŸÜÿØ ÿßŸÑŸàŸÇŸàŸÅ */
        .navbar li {
            position: relative;
            overflow: hidden;
        }

        .navbar li .shine {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background: linear-gradient(120deg, transparent 0%, #fff8 40%, #fff 50%, #fff8 60%, transparent 100%);
            transform: translateX(-100%);
            animation: shine-move 1.2s linear infinite;
            z-index: 2;
            display: none;
        }

        .navbar li.active .shine {
            animation-play-state: running;
            display: block;
        }

        @keyframes shine-move {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }
    </style>
</head>

<body>
    <!-- Loader Icon (under navbar) -->
    <div id="mainLoader"
        style="position:absolute;z-index:9000;top:110px;left:0;width:100vw;height:calc(100vh - 110px);background:rgba(255,255,255,0.95);display:none;align-items:center;justify-content:center;transition:opacity 0.4s;">
        <div style="display:flex;flex-direction:column;align-items:center;">
            <div
                style="position:relative;width:60px;height:60px;display:flex;align-items:center;justify-content:center;">
                <div class="loader-spinner"
                    style="border:4px solid #e0e0e0;border-top:4px solid #784fe7;border-radius:50%;width:44px;height:44px;animation:spin 1s linear infinite;position:absolute;left:8px;top:8px;">
                </div>
                <img src="icon1.png" alt="ÿπÿ∑ÿ±"
                    style="width:38px;height:38px;object-fit:contain;z-index:2;position:relative;filter:drop-shadow(0 2px 8px #b9b4e7cc);" />
            </div>
            <div style="margin-top:14px;font-size:1.1rem;color:#784fe7;font-weight:bold;">Loading...</div>
        </div>
    </div>
    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <!-- ŸÜŸáÿßŸäÿ© ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
    <!-- Splash Screen -->
    <div id="splashScreen"
        style="position:fixed;z-index:20000;top:0;left:0;width:100vw;height:100vh;background:#faf9f6;display:flex;align-items:center;justify-content:center;flex-direction:column;transition:opacity 0.4s;">
        <img id="splashLogo" src="icon1.png" alt="Logo" style="width:120px;height:120px;" />
    </div>
    <!-- ŸÜŸáÿßŸäÿ© ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
    <div id="headerBar" style="position:sticky;top:0;z-index:10000;background:#fff;box-shadow:0 2px 8px #e0e0e0;">
        <div style="display:flex;flex-direction:column;align-items:stretch;">
            <!-- ÿ¥ÿ±Ÿäÿ∑ ŸÖÿßÿ±ŸÉŸä ŸÖÿ™ÿ≠ÿ±ŸÉ ÿ£ÿπŸÑŸâ ÿßŸÑŸÑŸàÿ¨Ÿà -->
            <div id="promoBar"
                style="width:100%;background:#784fe7;color:#fff;font-size:1.5rem;font-weight:bold;letter-spacing:2px;position:relative;overflow:hidden;height:34px;display:flex;align-items:center;justify-content:center;">
                <div style="white-space:nowrap;display:inline-block;animation:marquee 20s linear infinite;">
                    Buy <b style="color: #8f0794;">3</b> & Get <b style="color: #8f0794;">1</b> Free !! &nbsp; ‚Ä¢ &nbsp;
                    Buy <b style="color: #8f0794;">5</b> & Get <b style="color: #8f0794;">2</b> Free !! &nbsp; ‚Ä¢ &nbsp;
                    Buy <b style="color: #8f0794;">3</b> & Get <b style="color: #8f0794;">1</b> Free !! &nbsp; ‚Ä¢
                    &nbsp;Buy <b style="color: #8f0794;">5</b> & Get <b style="color: #8f0794;">2</b> Free !!
                </div>
            </div>

            <div style="width:100%;display:flex;justify-content:center;align-items:center;">
                <div class="logo" style="display:flex;justify-content:center;align-items:center;">
                    <img src="icon1.png" alt="ÿπÿ∑ÿ±" style="height:54px;width:auto;display:block;" />
                </div>
            </div>
            <div style="width:100%;display:flex;justify-content:center;align-items:center;margin:8px 0 0 0;gap:12px;">
                <div id="searchBarContainer"
                    style="display:flex;justify-content:center;align-items:center;gap:12px;margin:0;">
                    <input id="searchInput" type="text" placeholder=" Search ...               üîç"
                        style="width:70%;max-width:400px;padding:10px 16px;font-size:1.2rem;border-radius:12px; border:2px solid #b9b4e7; background:#faf9f6;" />
                </div>
            </div>
            <nav class="navbar" style="background:none;box-shadow:none;padding-bottom:0;justify-content:center;">
                <ul style="margin:0 auto;">
                    <li data-section="admin" id="adminBtn" title="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ"></li>
                    <li style="padding-top: 7px;" data-section="man" class="active">Man</li>
                    <li style="padding-top: 7px;" data-section="woman">Woman</li>
                    <li style="padding-top: 7px;" data-section="offers">Offers</li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Fixed Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav">
        <div class="bottom-nav-item active home-item" onclick="switchNav(this, 'home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>Home</span>
        </div>
        <div class="bottom-nav-item cart-item" onclick="switchNav(this, 'cart')" style="position:relative;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span id="cartBadge" class="nav-badge" style="display:none;">0</span>
            <span>Cart</span>
        </div>
        <div class="bottom-nav-item fav-item" onclick="switchNav(this, 'favorites')" style="position:relative;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
            <span id="favBadge" class="nav-badge" style="display:none;">0</span>
            <span>Favorites</span>
        </div>
        <div class="bottom-nav-item profile-item" onclick="switchNav(this, 'profile')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span>Account</span>
        </div>
    </div>
    <button id="scrollTopBtn"
        style="display:none;position:fixed;bottom:100px;right:16px;z-index:9999;background:#b9b4e7;border:none;border-radius:50%;width:54px;height:54px;box-shadow:0 2px 12px #e0e0e0;cursor:pointer;align-items:center;justify-content:center;transition:opacity 0.3s;">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="12" fill="#b9b4e7" />
            <path d="M8 14l4-4 4 4" stroke="#5a4e7c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
    </button>
    <button id="whatsappBtn"
        style="display:flex;position:fixed;bottom:165px;right:16px;z-index:9999;background:#25d366;border:none;border-radius:50%;width:54px;height:54px;box-shadow:0 2px 12px #0007;cursor:pointer;align-items:center;justify-content:center;transition:opacity 0.3s;">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="16" cy="16" r="16" fill="#25d366" />
            <path
                d="M23 16.5c0-4.142-3.358-7.5-7.5-7.5s-7.5 3.358-7.5 7.5c0 1.326.347 2.57.95 3.646L8 24l3.972-1.312A7.47 7.47 0 0 0 15.5 24c4.142 0 7.5-3.358 7.5-7.5zm-7.5 6.5c-1.13 0-2.19-.293-3.104-.805l-.221-.13-2.36.78.78-2.36-.13-.221A6.48 6.48 0 0 1 9 16.5c0-3.584 2.916-6.5 6.5-6.5s6.5 2.916 6.5 6.5-2.916 6.5-6.5 6.5zm3.35-4.05c-.184-.092-1.09-.537-1.257-.598-.168-.062-.29-.092-.413.092-.123.184-.474.598-.581.723-.107.123-.215.138-.399.046-.184-.092-.777-.286-1.48-.911-.545-.486-.913-1.086-1.02-1.27-.107-.184-.012-.283.08-.375.082-.081.184-.215.276-.323.092-.107.123-.184.184-.307.062-.123.031-.23-.016-.323-.046-.092-.414-1.07-.567-1.465-.153-.395-.299-.34-.413-.347-.107-.005-.23-.006-.353-.006-.123 0-.323.046-.492.23-.168.184-.638.573-.638 1.398 0 .825.573 1.623.653 1.739.08.115 1.127 1.72 2.73 2.347.382.132.68.211.914.27.384.092.734.079 1.011.048.308-.034.949-.388 1.084-.763.134-.375.134-.696.094-.763-.04-.067-.153-.107-.32-.184z"
                fill="#fff" />
        </svg>
    </button>
    <div id="addToCartMsg" class="add-to-cart-msg"></div>
    <div class="container" id="mainContainer">
        <!-- ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ Ÿäÿ™ÿ∫Ÿäÿ± ŸáŸÜÿß -->
    </div>
    <div id="adminLoginModal" class="admin-login-modal" style="display:none;">
        <div class="admin-login-box">
            <h2>Admin Login</h2>
            <input type="text" id="adminUsername" placeholder="Username">
            <input type="password" id="adminPassword" placeholder="Password">
            <button id="adminLoginBtn">Login</button>
            <div class="error" id="adminLoginError"></div>
        </div>
    </div>
    <script>
        // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÑŸàÿØÿ± ŸÑŸÖÿØÿ© 3 ÿ´ŸàÿßŸÜŸä ŸÅŸÇÿ∑ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        window.addEventListener('DOMContentLoaded', function () {
            var loader = document.getElementById('mainLoader');
            if (loader) {
                loader.style.display = 'flex';
                loader.style.opacity = '1';
                setTimeout(function () {
                    loader.style.opacity = '0';
                    setTimeout(function () {
                        loader.style.display = 'none';
                    }, 400); // ŸÜŸÅÿ≥ ŸÖÿØÿ© transition
                }, 3000); // 3 ÿ´ŸàÿßŸÜŸä
            }
        });
        // --- Firebase config ---
        const firebaseConfig = {
            apiKey: "AIzaSyABBNyziST2TOTr1YQv7nEAq_V1LVoymo0",
            authDomain: "abo-elela.firebaseapp.com",
            databaseURL: "https://abo-elela-default-rtdb.firebaseio.com",
            projectId: "abo-elela",
            storageBucket: "abo-elela.firebasestorage.app",
            messagingSenderId: "1094481849658",
            appId: "1:1094481849658:web:111289c004cfcfc9ef7403",
            measurementId: "G-V22KTTMVD8"
        };
        firebase.initializeApp(firebaseConfig);
        if (firebase.analytics) firebase.analytics();
        const db = firebase.database();

        // --- ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ Firebase ---
        let products = [];
        let editingProductIndex = null;
        const productTypes = [
            { key: 'man', label: 'Man' },
            { key: 'woman', label: 'Woman' },
            { key: 'offers', label: 'Offers' }
        ];
        // --- ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ---
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]'); // [{name, type}]
        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        function isFavorite(prod) {
            return favorites.some(f => f.name === prod.name && f.type === prod.type);
        }
        function toggleFavorite(name, type) {
            const idx = favorites.findIndex(f => f.name === name && f.type === type);
            if (idx > -1) {
                favorites.splice(idx, 1);
            } else {
                favorites.push({ name, type });
            }
            saveFavorites();
            updateFavoritesCount();
            const activeSection = document.querySelector('.navbar li.active')?.getAttribute('data-section');
            // ÿ•ÿ∞ÿß ŸÉŸÜÿß ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ÿå ÿ≠ÿØÿ´Ÿáÿß ŸÅŸÇÿ∑ ŸàŸÑÿß ÿ™ÿ∞Ÿáÿ® ŸÑÿ£Ÿä ÿµŸÅÿ≠ÿ© ÿ£ÿÆÿ±Ÿâ
            if (activeSection === 'favorites' || document.getElementById('mainContainer')?.querySelector('.section-title')?.textContent === 'ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™') {
                renderFavoritesSection();
            } else {
                renderProductsSection(activeSection);
            }
        }
        function updateFavoritesCount() {
            const favCount = document.getElementById('favoritesCount');
            if (favCount) favCount.innerText = favorites.length;
            const favBadge = document.getElementById('favBadge');
            if (favBadge) {
                favBadge.innerText = favorites.length;
                favBadge.style.display = favorites.length > 0 ? 'flex' : 'none';
            }
        }
        updateFavoritesCount();

        // ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ŸàŸäŸÑ ŸÜÿµ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ•ŸÑŸâ ŸÉÿßÿ¶ŸÜ Date (ŸäÿØÿπŸÖ toLocaleString) - ŸÖÿ™ÿßÿ≠ÿ© ÿπÿßŸÑŸÖŸäÿßŸã
        function parseOrderDate(str) {
            if (!str) return null;
            // Ÿäÿ≠ÿßŸàŸÑ ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ
            let d = new Date(str);
            if (!isNaN(d)) return d;
            // ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ (ÿ®ÿπÿ∂ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ÿßÿ™ ŸÑÿß ÿ™ÿØÿπŸÖ toLocaleString ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÅŸä Date constructor)
            let parts = str.split(',');
            if (parts.length > 1) {
                let datePart = parts[0].trim();
                let timePart = parts[1].trim();
                let d2 = new Date(datePart + ' ' + timePart);
                if (!isNaN(d2)) return d2;
            }
            return null;
        }
        // ÿ¨ŸÑÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ Ÿàÿ™ÿ≠ÿØŸäÿ´Ÿáÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        function listenToProducts() {
            db.ref('gymProducts').on('value', snapshot => {
                const val = snapshot.val() || {};
                // ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ≥ÿ™ŸÉŸàŸÜ ŸÉŸÉÿßÿ¶ŸÜ (id -> product)
                products = Object.values(val);

                // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ŸÖÿπÿ±Ÿàÿ∂ÿ© ÿ≠ÿßŸÑŸäÿßŸã
                const catalogActive = !!document.getElementById('productsGrid');
                if (catalogActive) {
                    const activeSection = document.querySelector('.navbar li.active')?.getAttribute('data-section') || 'man';
                    renderProductsSection(activeSection);
                }

                // ÿ•ÿ∞ÿß ŸÉŸÜÿß ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜÿå ÿ≠ÿØÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                if (document.getElementById('adminProductsList')) renderAdminProductsList();

                // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÑŸàÿØÿ± ÿ®ÿπÿØ ÿ£ŸàŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
                const loader = document.getElementById('mainLoader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => { loader.style.display = 'none'; }, 400);
                }
            });
        }
        listenToProducts();

        // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function saveProductsToDB() {
            db.ref('gymProducts').set(products);
        }

        // --- ÿ≥ŸÑÿßŸäÿØÿ± ÿßŸÑÿµŸàÿ± Ÿàÿ™ŸÉÿ®Ÿäÿ±Ÿáÿß ---
        function showImageModalForProduct(prod, startIdx = 0) {
            if (!prod.images || !prod.images.length) return;
            let currentIdx = startIdx;
            let modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = 0;
            modal.style.left = 0;
            modal.style.right = 0;
            modal.style.bottom = 0;
            modal.style.background = 'rgba(0,0,0,0.85)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = 99999;
            // ÿ®ŸÜÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÇŸÑŸäÿ® ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿµŸàÿ±ÿ©
            let arrowsHtml = '';
            if (prod.images.length > 1) {
                arrowsHtml = `
                    <button id="prevImgBtn" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);background:#fff8;border:none;border-radius:50%;width:38px;height:38px;font-size:2rem;cursor:pointer;z-index:10;opacity:0.85;">‚Äπ</button>
                    <button id="nextImgBtn" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:#fff8;border:none;border-radius:50%;width:38px;height:38px;font-size:2rem;cursor:pointer;z-index:10;opacity:0.85;">‚Ä∫</button>
                `;
            }
            modal.innerHTML = `
                <div id="modalImageSlider" style="position:relative;display:flex;flex-direction:column;align-items:center;">
                    <button id="closeModalBtn" style="position:absolute;top:-30px;right:0;background:#fff;border:none;border-radius:50%;width:32px;height:32px;font-size:1.3rem;cursor:pointer;z-index:10;">√ó</button>
                    <div style="position:relative;display:flex;align-items:center;justify-content:center;">
                        <img id="modalImg" src="${prod.images[currentIdx]}" style="max-width:80vw;max-height:70vh;border-radius:12px;border:4px solid #ec35e3;box-shadow:0 2px 16px #0007;" />
                        ${arrowsHtml}
                    </div>
                    <div id="imgCounter" style="margin-top:18px;color:#fff;font-size:1.2rem;font-weight:bold;text-shadow:0 2px 8px #000;">${currentIdx + 1}/${prod.images.length}</div>
                </div>
            `;
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨ ÿßŸÑÿµŸàÿ±ÿ© ÿ£Ÿà ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
            modal.onclick = function (e) {
                if (e.target === modal || e.target.id === 'closeModalBtn') document.body.removeChild(modal);
            };
            document.body.appendChild(modal);
            // ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÇŸÑŸäÿ® ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿµŸàÿ±ÿ©
            if (prod.images.length > 1) {
                const updateImg = () => {
                    modal.querySelector('#modalImg').src = prod.images[currentIdx];
                    modal.querySelector('#imgCounter').innerText = `${currentIdx + 1}/${prod.images.length}`;
                };
                modal.querySelector('#prevImgBtn').onclick = function (e) {
                    e.stopPropagation();
                    currentIdx = (currentIdx - 1 + prod.images.length) % prod.images.length;
                    updateImg();
                };
                modal.querySelector('#nextImgBtn').onclick = function (e) {
                    e.stopPropagation();
                    currentIdx = (currentIdx + 1) % prod.images.length;
                    updateImg();
                };
            }
        }
        // --- ÿ™ÿπÿØŸäŸÑ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿµŸàÿ±ÿ© ---
        function renderProductsSection(typeKey) {
            const container = document.getElementById('mainContainer');
            const type = productTypes.find(t => t.key === typeKey);
            // ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿÆŸÅŸäÿ© ŸÅŸÇÿ∑ + ÿßŸÑÿ®ÿ≠ÿ´
            const searchTerm = (window.currentSearchTerm || '').toLowerCase();
            const filtered = products.filter(p =>
                p.type === typeKey &&
                !p.hidden &&
                (
                    !searchTerm ||
                    (p.name && p.name.toLowerCase().includes(searchTerm)) ||
                    (p.desc && p.desc.toLowerCase().includes(searchTerm))
                )
            );
            let html = `<div class='section-title'>${type ? type.label : ''}</div>`;
            if (filtered.length === 0) {
                html += `<div style='text-align:center;'>No products in this section yet.</div>`;
                container.innerHTML = html;
                return;
            }
            // --- ÿπÿ±ÿ∂ ÿ£ŸàŸÑ 4 ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸàÿ±Ÿãÿß ---
            let initialCount = filtered.length; // ÿπÿ±ÿ∂ ŸÉŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸàÿ±Ÿãÿß ÿ®ÿØŸàŸÜ delay
            let shown = Math.min(initialCount, filtered.length);
            html += `<div class='products-grid' id='productsGrid'></div>`;
            container.innerHTML = html;
            const grid = document.getElementById('productsGrid');
            // ÿØÿßŸÑÿ© ÿ™ŸàŸÑŸäÿØ ŸÉŸàÿØ ÿßŸÑŸÖŸÜÿ™ÿ¨ (ŸÜŸÅÿ≥ ÿßŸÑŸÉŸàÿØ ÿßŸÑÿ≥ÿßÿ®ŸÇ)
            function productCardHtml(prod, idx) {
                const fadeDelay = idx * 60; // 60ms ŸÑŸÉŸÑ ÿ®ÿ∑ÿßŸÇÿ©
                let slider = '';
                if (prod.images && prod.images.length > 1) {
                    slider = `
                        <div class='img-slider' style='position:relative;'>
                            <img src='${prod.images[0]}' loading='lazy' class='slider-img' style='cursor:pointer;' onclick='window.showImageModalForProduct(products[${products.indexOf(prod)}],0)' data-slider-idx='0' data-prod-idx='${idx}'>
                            <button class='slider-btn left' onclick='event.stopPropagation();window.changeSlide(this,${idx},-1)' style='position:absolute;left:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Äπ</button>
                            <button class='slider-btn right' onclick='event.stopPropagation();window.changeSlide(this,${idx},1)' style='position:absolute;right:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Ä∫</button>
                        </div>`;
                } else {
                    // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿµŸàÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑ ÿ£Ÿà ŸÖÿµŸÅŸàŸÅÿ© ÿßŸÑÿµŸàÿ± ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸÅÿ© ÿ£Ÿà ŸÅÿßÿ±ÿ∫ÿ©
                    let imgSrc = (prod.images && prod.images.length > 0) ? prod.images[0] : '';
                    slider = imgSrc ? `<img src='${imgSrc}' loading='lazy' style='cursor:pointer;' onclick='window.showImageModalForProduct(products[${products.indexOf(prod)}],0)'>`
                        : `<div style='width:180px;height:180px;background:#f0f0f0;border-radius:8px;border:2px solid #eec9d2;display:flex;align-items:center;justify-content:center;color:#ccc;'>No Image</div>`;
                }
                let discount = getDiscountPercent(prod.priceBefore, prod.priceAfter);
                let discountHtml = discount ? `<span style='background:#ff4444;color:#fff;padding:2px 8px;border-radius:6px;font-size:1rem;position:absolute;left:10px;top:10px;'>${discount}% OFF</span>` : '';
                let fav = isFavorite(prod);
                let heartBtn = `<button onclick='window.toggleFavorite("${prod.name.replace(/\"/g, '&quot;')}", "${prod.type}")' style='position:absolute;top:6px;right:0;background:none;border:none;cursor:pointer;z-index:10;'>
                        <svg width='32' height='32' viewBox='0 0 24 24' fill='${fav ? "#ff4444" : "none"}' stroke='#ff4444' stroke-width='2'><path d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/></svg>
                    </button>`;
                let availableHtml = (prod.available === false) ? `<div style='color:#ff4444;font-weight:bold;margin-top:6px;'>Out of Stock</div>` : '';
                return `
                    <div class='product-card' style='overflow:visible; --fade-delay:${fadeDelay}ms;'>
                        <div style='position:relative;'>
                            ${slider}
                            ${heartBtn}
                            ${discountHtml}
                            ${availableHtml}
                        </div>
                        <div class='product-title'>${prod.name}</div>
                        <div class='product-desc'>${prod.desc}</div>
                        <div class='product-type'>${type ? type.label : ''}</div>
                        <div class='product-prices'>
                            <del>${prod.priceBefore} EGP</del> <span>${prod.priceAfter} EGP</span>
                        </div>
                        ${(prod.available === false) ? '' : `<button class='add-to-cart-btn' onclick='addToCart(${JSON.stringify(prod)})' style='background:#25d366;color:#fff;font-weight:bold;padding:8px 0;border-radius:6px;width:100%;margin-top:8px;font-size:1.1rem;cursor:pointer;border:none;'>Add to Cart</button>`}
                    </div>
                `;
            }
            // ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿØŸÅÿπÿ© Ÿàÿßÿ≠ÿØÿ©
            for (let i = 0; i < filtered.length; i++) {
                grid.insertAdjacentHTML('beforeend', productCardHtml(filtered[i], i));
            }
            // --- ÿ•ÿ∏Ÿáÿßÿ± ÿ®ÿßŸÇŸä ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ™ÿØÿ±Ÿäÿ¨ŸäŸãÿß ---
            if (filtered.length > initialCount) {
                let nextIdx = initialCount;
                function showNextBatch() {
                    let batch = 4;
                    let end = Math.min(nextIdx + batch, filtered.length);
                    for (let i = nextIdx; i < end; i++) {
                        grid.insertAdjacentHTML('beforeend', productCardHtml(filtered[i], i));
                    }
                    nextIdx = end;
                    if (nextIdx < filtered.length) {
                        setTimeout(showNextBatch, 300);
                    }
                }
                setTimeout(showNextBatch, 300);
            }
        }
        // --- ÿ≥ŸÑÿßŸäÿØÿ± ÿßŸÑÿµŸàÿ± ---
        window.changeSlide = function (btn, filteredIdx, dir) {
            // ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÉŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ© ÿ≠ÿßŸÑŸäŸãÿß
            const section = document.querySelector('.navbar li.active').getAttribute('data-section');
            const searchTerm = (window.currentSearchTerm || '').toLowerCase();
            const filtered = products.filter(p =>
                p.type === section &&
                !p.hidden &&
                (
                    !searchTerm ||
                    (p.name && p.name.toLowerCase().includes(searchTerm)) ||
                    (p.desc && p.desc.toLowerCase().includes(searchTerm))
                )
            );
            const prod = filtered[filteredIdx];
            let img = btn.parentElement.querySelector('.slider-img');
            let current = parseInt(img.getAttribute('data-slider-idx')) || 0;
            current = (current + dir + prod.images.length) % prod.images.length;
            img.src = prod.images[current];
            img.setAttribute('onclick', `showImageModal("${prod.images[current]}")`);
            img.setAttribute('data-slider-idx', current);
        }
        window.showImageModalForProduct = showImageModalForProduct;
        // --- ÿ≠ÿ≥ÿßÿ® ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿÆÿµŸÖ ---
        function getDiscountPercent(before, after) {
            before = parseFloat(before); after = parseFloat(after);
            if (!before || !after || after >= before) return '';
            return Math.round(100 * (before - after) / before);
        }
        // ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑÿ£ÿØŸÖŸÜ
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'flex';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminLoginError').innerText = '';
            document.querySelector('.admin-login-box h2').innerText = 'Admin Login';
            document.getElementById('adminUsername').placeholder = 'Username';
            document.getElementById('adminPassword').placeholder = 'Password';
            document.getElementById('adminLoginBtn').innerText = 'Login';
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿØÿ´ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ Enter
            var usernameInput = document.getElementById('adminUsername');
            var passwordInput = document.getElementById('adminPassword');
            var loginBtn = document.getElementById('adminLoginBtn');
            function tryLogin(e) {
                if (e.key === 'Enter') {
                    loginBtn.click();
                }
            }
            usernameInput.onkeydown = tryLogin;
            passwordInput.onkeydown = tryLogin;
        }
        function hideAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
        }
        document.getElementById('adminBtn').onclick = showAdminLogin;
        document.getElementById('adminLoginBtn').onclick = function () {
            const user = document.getElementById('adminUsername').value.trim();
            const pass = document.getElementById('adminPassword').value.trim();
            if (user === '0' && pass === '0') {
                hideAdminLogin();
                renderAdminPanel();
            } else {
                document.getElementById('adminLoginError').innerText = 'Invalid login data';
            }
        };
        // ÿßÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨Ÿáÿß
        document.getElementById('adminLoginModal').onclick = function (e) {
            if (e.target === this) hideAdminLogin();
        };

        // --- Professional Admin Dashboard Framework ---
        function renderAdminPanel() {
            renderAdminDashboard('overview');
        }

        function renderAdminDashboard(activeTab = 'overview') {
            // ÿ•ÿÆŸÅÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿπÿßŸÖÿ©
            togglePublicUI(false);

            const container = document.getElementById('mainContainer');
            container.style.maxWidth = '100%';
            container.style.width = '100%';
            container.style.margin = '0';
            container.style.padding = '0';
            container.style.boxShadow = 'none';
            container.style.borderRadius = '0';

            const tabs = [
                { id: 'overview', label: 'Overview', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>` },
                { id: 'products', label: 'Products', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>` },
                { id: 'orders', label: 'Orders', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>` },
                { id: 'codes', label: 'Discount Codes', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>` }
            ];

            let html = `
            <div class="admin-dash-container" style="height:100vh; min-height:100vh; margin-top:0; border-radius:0;">
                <div class="dash-sidebar">
                    <div style="padding:0 24px 20px; font-weight:800; font-size:1.4rem; color:#784fe7; letter-spacing:1px;">ADMIN DASH</div>
                    ${tabs.map(t => `
                        <div class="dash-sidebar-item ${activeTab === t.id ? 'active' : ''}" onclick="switchDashTab('${t.id}')">
                            ${t.icon}
                            <span>${t.label}</span>
                        </div>
                    `).join('')}
                    <div style="margin-top:auto; padding-top:20px; border-top:1px solid #333;">
                        <div class="dash-sidebar-item" onclick="exitAdminDashboard()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                            <span>Home Page</span>
                        </div>
                    </div>
                </div>
                <div class="dash-main" id="dashMainContent">
                    <!-- Dynamic content loads here -->
                </div>
            </div>`;

            container.innerHTML = html;
            loadTabContent(activeTab);
        }

        // ÿØÿßŸÑÿ© ŸÑŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ Ÿàÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        window.exitAdminDashboard = function () {
            togglePublicUI(true);
            const container = document.getElementById('mainContainer');
            if (container) {
                container.style.maxWidth = '1100px';
                container.style.width = '';
                container.style.margin = '16px auto 0 auto';
                container.style.padding = '20px';
                container.style.boxShadow = '0 4px 24px #e0e0e0';
                container.style.borderRadius = '12px';
                container.style.border = '1px solid #784fe733';
            }
            // ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑŸÜÿ¥ÿ∑ (ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸãÿß Man)
            document.querySelectorAll('.navbar li').forEach(l => l.classList.remove('active'));
            const manTab = document.querySelector('.navbar li[data-section="man"]');
            if (manTab) manTab.classList.add('active');
            renderProductsSection('man');
        };

        // ÿØÿßŸÑÿ© ÿ•ÿÆŸÅÿßÿ°/ÿ•ÿ∏Ÿáÿßÿ± ÿπŸÜÿßÿµÿ± ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿπÿßŸÖÿ©
        function togglePublicUI(show) {
            const display = show ? '' : 'none';
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸáŸäÿØÿ± (ÿßŸÑÿ¥ÿπÿßÿ± ŸàÿßŸÑÿ®ÿ≠ÿ´)
            const header = document.querySelector('.header');
            if (header) header.style.display = display;

            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.style.display = display;

            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿπŸÑŸàŸä
            const navbar = document.querySelector('.navbar');
            if (navbar) navbar.style.display = show ? 'flex' : 'none';

            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿ≥ŸÅŸÑŸä
            const bottomNav = document.querySelector('.bottom-nav');
            if (bottomNav) bottomNav.style.display = show ? 'flex' : 'none';

            // ÿ•ÿ≤ÿßŸÑÿ© ÿ≠ÿ¥Ÿàÿ© ÿßŸÑŸÄ body
            document.body.style.paddingBottom = show ? '80px' : '0';
            document.body.style.overflow = show ? 'auto' : 'hidden'; // ŸÖŸÜÿπ ÿßŸÑÿ≥ŸÉÿ±ŸàŸÑ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿä
        }

        window.switchDashTab = function (tabId) {
            document.querySelectorAll('.dash-sidebar-item').forEach(item => item.classList.remove('active'));
            const clicked = Array.from(document.querySelectorAll('.dash-sidebar-item')).find(item => item.textContent.includes(tabId.charAt(0).toUpperCase() + tabId.slice(1)));
            if (clicked) clicked.classList.add('active');
            loadTabContent(tabId);
        };

        function loadTabContent(tabId) {
            const main = document.getElementById('dashMainContent');
            if (tabId === 'overview') renderDashOverview(main);
            if (tabId === 'products') renderDashProducts(main);
            if (tabId === 'orders') renderDashOrders(main);
            if (tabId === 'codes') renderDashCodes(main);
        }

        function renderDashOverview(target) {
            target.innerHTML = `
                <div class="dash-header"><h2>Analytics Overview</h2></div>
                <div id="dashStatsGrid" class="stat-grid">Loading stats...</div>
                
                <div style="display:grid; grid-template-columns: 2fr 1fr; gap:24px; margin-bottom:30px;">
                    <div style="background:#fff; padding:20px; border-radius:12px; border:1px solid #eee; box-shadow:0 4px 12px rgba(0,0,0,0.03);">
                        <h3 style="margin-top:0; color:#333;">Revenue Trend (Last 7 Days)</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div style="background:#fff; padding:20px; border-radius:12px; border:1px solid #eee; box-shadow:0 4px 12px rgba(0,0,0,0.03);">
                        <h3 style="margin-top:0; color:#333;">Sales by Category</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <div style="background:#f9f9f9; padding:20px; border-radius:12px;">
                    <h3 style="margin-top:0;">Quick Filters</h3>
                    <div style="display:flex; gap:12px; flex-wrap:wrap;">
                        <label>From: <input type="date" id="analysisFromDate" onchange="updateDashOverview()"></label>
                        <label>To: <input type="date" id="analysisToDate" onchange="updateDashOverview()"></label>
                        <button onclick="clearDashFilters()" style="background:#ff4444; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;">Clear</button>
                    </div>
                </div>
            `;
            updateDashOverview();
        }

        let revenueChartInstance = null;
        let categoryChartInstance = null;

        function updateDashOverview() {
            const grid = document.getElementById('dashStatsGrid');
            if (!grid) return;

            let fromDate = document.getElementById('analysisFromDate')?.value;
            let toDate = document.getElementById('analysisToDate')?.value;
            let from = fromDate ? new Date(fromDate + 'T00:00:00') : null;
            let to = toDate ? new Date(toDate + 'T23:59:59') : null;

            // Product Counts
            let manCount = products.filter(p => p.type === 'man' && !p.hidden).length;
            let womanCount = products.filter(p => p.type === 'woman' && !p.hidden).length;
            let offersCount = products.filter(p => p.type === 'offers' && !p.hidden).length;
            let totalProducts = products.filter(p => !p.hidden).length;

            db.ref('orders').once('value', snap => {
                const ordersArr = Object.values(snap.val() || {});
                let filtered = ordersArr;
                if (from || to) {
                    filtered = ordersArr.filter(order => {
                        let d = parseOrderDate(order.time);
                        if (!d) return false;
                        return (!from || d >= from) && (!to || d <= to);
                    });
                }

                let cancelled = filtered.filter(o => o.status === 'Cancelled' || o.status === 'ŸÖŸÑÿ∫Ÿä').length;
                let delivered = filtered.filter(o => o.status === 'Delivered' || o.status === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ').length;
                let pending = filtered.length - (cancelled + delivered);
                let revenue = filtered.filter(o => o.status === 'Delivered' || o.status === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ').reduce((s, o) => s + parseFloat(o.total || 0), 0);

                grid.innerHTML = `
                    <div class="stat-card"><div class="label">Revenue (Delivered)</div><div class="value">${revenue} EGP</div></div>
                    <div class="stat-card"><div class="label">Total Orders</div><div class="value">${filtered.length}</div></div>
                    <div class="stat-card"><div class="label">Pending</div><div class="value" style="color:#ffb300;">${pending}</div></div>
                    <div class="stat-card"><div class="label">Delivered</div><div class="value" style="color:#25d366;">${delivered}</div></div>
                    <div class="stat-card"><div class="label">Total Products</div><div class="value">${totalProducts}</div></div>
                    <div class="stat-card"><div class="label">Man / Woman / Offers</div><div class="value" style="font-size:1.2rem;">${manCount} / ${womanCount} / ${offersCount}</div></div>
                `;

                // --- Update Charts ---
                updateCharts(filtered);
            });
        }

        function updateCharts(orders) {
            // 1. Revenue Chart Data (Last 7 Days from orders or filter)
            const days = {};
            const today = new Date();
            for (let i = 6; i >= 0; i--) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                const key = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                days[key] = 0;
            }

            orders.forEach(o => {
                if (o.status === 'Delivered' || o.status === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ') {
                    const d = parseOrderDate(o.time);
                    if (d) {
                        const key = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        if (days[key] !== undefined) days[key] += parseFloat(o.total || 0);
                    }
                }
            });

            const revCtx = document.getElementById('revenueChart');
            if (revCtx) {
                if (revenueChartInstance) revenueChartInstance.destroy();
                revenueChartInstance = new Chart(revCtx, {
                    type: 'line',
                    data: {
                        labels: Object.keys(days),
                        datasets: [{
                            label: 'Revenue (EGP)',
                            data: Object.values(days),
                            borderColor: '#784fe7',
                            backgroundColor: 'rgba(120, 79, 231, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { responsive: true }
                });
            }

            // 2. Category Chart Data
            let catStats = { 'Man': 0, 'Woman': 0, 'Offers': 0 };
            orders.forEach(o => {
                if (o.items) {
                    o.items.forEach(item => {
                        if (item.type === 'man') catStats['Man']++;
                        else if (item.type === 'woman') catStats['Woman']++;
                        else catStats['Offers']++;
                    });
                }
            });

            const catCtx = document.getElementById('categoryChart');
            if (catCtx) {
                if (categoryChartInstance) categoryChartInstance.destroy();
                categoryChartInstance = new Chart(catCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(catStats),
                        datasets: [{
                            data: Object.values(catStats),
                            backgroundColor: ['#784fe7', '#ffb300', '#25d366']
                        }]
                    },
                    options: { responsive: true }
                });
            }
        }

        window.clearDashFilters = function () {
            if (document.getElementById('analysisFromDate')) document.getElementById('analysisFromDate').value = '';
            if (document.getElementById('analysisToDate')) document.getElementById('analysisToDate').value = '';
            updateDashOverview();
        };

        function renderDashProducts(target) {
            target.innerHTML = `
                <div class="dash-header">
                    <h2>Stock Management</h2>
                    <button class="add-product-btn" onclick="showProductForm()" style="margin:0;">+ Add New Product</button>
                </div>
                <div id="productFormContainer"></div>
                <div class="products-list" id="adminProductsList"></div>
            `;
            renderAdminProductsList();
        }

        function renderDashOrders(target) {
            target.innerHTML = `
                <div class="dash-header"><h2>Orders Management</h2></div>
                <div id="ordersList">Loading orders...</div>
            `;
            renderOrdersList();
        }

        function renderDashCodes(target) {
            target.innerHTML = `
                <div class="dash-header"><h2>Promotion Codes</h2></div>
                <div id="discountCodesPage">Loading codes...</div>
            `;
            renderDiscountCodesPage();
        }
        // ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ŸÖŸÜÿ™ÿ¨
        function showProductForm(editIndex = null) {
            editingProductIndex = editIndex;
            let prod = { name: '', desc: '', images: [], priceBefore: '', priceAfter: '', type: productTypes[0].key, available: true };
            if (editIndex !== null) prod = products[editIndex];
            // ŸÖÿ™ÿ∫Ÿäÿ± ŸÑŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±
            let currentImages = prod.images ? [...prod.images] : [];
            let html = `<form class='product-form' id='productForm'>
                <label>Product Name</label>
                <input type='text' name='name' value='${prod.name || ''}' required>
                <label>Description</label>
                <textarea name='desc' rows='2' required>${prod.desc || ''}</textarea>
                <label>Image Links (one per line)</label>
                <textarea name='imageLinks' rows='3' placeholder='ÿ∂ÿπ ŸÉŸÑ ŸÑŸäŸÜŸÉ ÿµŸàÿ±ÿ© ŸÅŸä ÿ≥ÿ∑ÿ± ŸÖŸÜŸÅÿµŸÑ' required>${currentImages.join('\n')}</textarea>
                <div id='previewImages' style='display:flex;gap:8px;margin-bottom:8px;'></div>
                <label>Price Before Discount</label>
                <input type='number' name='priceBefore' value='${prod.priceBefore || ''}' required>
                <label>Price After Discount</label>
                <input type='number' name='priceAfter' value='${prod.priceAfter || ''}' required>
                <label>Product Type</label>
                <select name='type'>
                    ${productTypes.map(t => `<option value='${t.key}' ${prod.type === t.key ? 'selected' : ''}>${t.label}</option>`).join('')}
                </select>
                <label>ŸÖÿ™ŸàŸÅÿ±ÿü</label>
                <select name='available'>
                    <option value='true' ${prod.available !== false ? 'selected' : ''}>ŸÖÿ™ŸàŸÅÿ±</option>
                    <option value='false' ${prod.available === false ? 'selected' : ''}>ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±</option>
                </select>
                <button type='submit'>${editIndex !== null ? 'Edit Product' : 'Add Product'}</button>
                <button type='button' onclick='hideProductForm()' style='margin-right:10px;background:#333;color:#fff;'>Cancel</button>
            </form>`;
            document.getElementById('productFormContainer').innerHTML = html;
            // ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ÿ•ŸÑŸâ ÿßŸÑŸÅŸàÿ±ŸÖ ÿπŸÜÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            if (editIndex !== null) {
                document.getElementById('productFormContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            // ÿπÿ±ÿ∂ ÿßŸÑÿµŸàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿπŸÜÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            if (currentImages.length) {
                showPreviewImages(currentImages);
            }
            // ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ± ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑
            document.querySelector('#productForm textarea[name="imageLinks"]').addEventListener('input', function (e) {
                const links = this.value.split('\n').map(x => x.trim()).filter(Boolean);
                currentImages = links;
                showPreviewImages(currentImages);
            });
            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ
            document.getElementById('productForm').onsubmit = function (e) {
                e.preventDefault();
                const fd = new FormData(this);
                let images = fd.get('imageLinks').split('\n').map(x => x.trim()).filter(Boolean);
                let newProd = {
                    name: fd.get('name'),
                    desc: fd.get('desc'),
                    images: images,
                    priceBefore: fd.get('priceBefore'),
                    priceAfter: fd.get('priceAfter'),
                    type: fd.get('type'),
                    available: fd.get('available') === 'true'
                };
                saveProductData(newProd);
            };
        }
        function showPreviewImages(imgs) {
            const preview = document.getElementById('previewImages');
            preview.innerHTML = '';
            imgs.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.style.width = '50px';
                img.style.height = '50px';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '5px';
                img.style.border = '1px solid #784fe7';
                preview.appendChild(img);
            });
        }
        function hideProductForm() {
            var el = document.getElementById('productFormContainer');
            if (el) el.innerHTML = '';
        }
        function saveProductData(prod) {
            if (editingProductIndex !== null) {
                // ÿ™ÿπÿØŸäŸÑ ŸÖŸÜÿ™ÿ¨: ÿ≠ÿØÿ´ ÿßŸÑŸÖÿµŸÅŸàŸÅÿ© Ÿàÿßÿ≠ŸÅÿ∏Ÿáÿß ŸÉÿßŸÖŸÑÿ©
                products[editingProductIndex] = prod;
                saveProductsToDB();
                editingProductIndex = null;
                hideProductForm();
                // ŸÑÿß ŸÜÿ≠ÿ™ÿßÿ¨ ŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ° renderAdminProductsList ŸáŸÜÿß ŸÑÿ£ŸÜ ÿßŸÑŸÄ Firebase listener ÿ≥ŸäŸÅÿπŸÑ ÿ∞ŸÑŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
            } else {
                // ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ: ÿßÿ≥ÿ™ÿÆÿØŸÖ push ŸÅŸä Firebase
                db.ref('gymProducts').push(prod, function (error) {
                    if (!error) {
                        hideProductForm();
                        // ŸÑÿß ŸÜÿ≥ÿ™ÿØÿπŸä listenToProducts() ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÑÿ£ŸÜ .on('value') ŸäÿπŸÖŸÑ ÿ®ÿßÿ≥ÿ™ŸÖÿ±ÿßÿ± ŸàŸäÿ∂ŸäŸÅ ŸÖÿ≥ÿ™ŸÖÿπŸäŸÜ ÿ¨ÿØÿØ
                    } else {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨!');
                    }
                });
            }
        }
        // ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ
        function renderAdminProductsList() {
            const list = document.getElementById('adminProductsList');
            if (!list) return;
            if (!products.length) {
                list.innerHTML = '<div style="text-align:center;">No products yet.</div>';
                return;
            }
            let html = '';
            products.forEach((prod, i) => {
                const type = productTypes.find(t => t.key === prod.type);
                let hideBtn = prod.hidden
                    ? `<button title='ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='toggleHideProduct(${i})'>
                        <svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M1 12C2.73 7.61 7.09 4.5 12 4.5C16.91 4.5 21.27 7.61 23 12C21.27 16.39 16.91 19.5 12 19.5C7.09 19.5 2.73 16.39 1 12Z' stroke='#784fe7' stroke-width='2'/><circle cx='12' cy='12' r='3.5' stroke='#784fe7' stroke-width='2'/></svg>
                    </button>`
                    : `<button title='ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='toggleHideProduct(${i})'>
                        <svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M17.94 17.94C16.13 19.24 14.13 20 12 20C7.09 20 2.73 16.39 1 12C1.73 10.19 2.91 8.61 4.44 7.36M9.9 5.08C10.59 4.86 11.29 4.73 12 4.73C16.91 4.73 21.27 8.34 23 13C22.27 14.81 21.09 16.39 19.56 17.64M1 1L23 23' stroke='#784fe7' stroke-width='2'/><circle cx='12' cy='12' r='3.5' stroke='#784fe7' stroke-width='2'/></svg>
                    </button>`;
                html += `<div class='product-card' draggable='true' data-index='${i}'
                    ondragstart='onAdminProductDragStart(event, ${i})'
                    ondragover='onAdminProductDragOver(event, ${i})'
                    ondrop='onAdminProductDragDrop(event, ${i})'
                    ondragend='onAdminProductDragEnd(event)'
                    style='opacity:1;transition:opacity 0.2s;'>
                    <span class='drag-handle' style='cursor:grab;font-size:2rem;color:#784fe7;user-select:none;margin-right:8px;' title='ÿßÿ≥ÿ≠ÿ® ŸÑŸÑÿ™ÿ±ÿ™Ÿäÿ®'>‚ò∞</span>
                    <img src="${prod.images[0] || ''}" loading="lazy" alt="ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨" style="cursor:pointer;" onclick="showImageModal('${prod.images[0]}')">
                    <div class='product-info'>
                        <div class='product-title'>${prod.name}</div>
                        <div class='product-desc'>${prod.desc}</div>
                        <div class='product-prices'><del>${prod.priceBefore} ÿ¨.ŸÖ</del> <span>${prod.priceAfter} ÿ¨.ŸÖ</span></div>
                        <div class='product-actions'>
                            <button title='ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='editProduct(${i})'>
                                <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M4 21H20' stroke='#784fe7' stroke-width='2'/><path d='M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L7 20L2 21L3 16L18.5 2.5Z' stroke='#784fe7' stroke-width='2'/></svg>
                            </button>
                            <button title='ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='deleteProduct(${i})'>
                                <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M3 6H5H21' stroke='#784fe7' stroke-width='2'/><path d='M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M10 11V17M14 11V17' stroke='#784fe7' stroke-width='2'/></svg>
                            </button>
                            ${hideBtn}
                        </div>
                    </div>
                </div>`;
            });
            list.innerHTML = html;
        }
        // --- Drag & Drop ŸÑŸÑÿ£ÿØŸÖŸÜ ---
        let dragSrcIndex = null;
        window.onAdminProductDragStart = function (e, idx) {
            dragSrcIndex = idx;
            e.dataTransfer.effectAllowed = 'move';
            e.currentTarget.style.opacity = '0.4';
        };
        window.onAdminProductDragOver = function (e, idx) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        };
        window.onAdminProductDragDrop = function (e, idx) {
            e.preventDefault();
            if (dragSrcIndex === null || dragSrcIndex === idx) return;
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
            const moved = products.splice(dragSrcIndex, 1)[0];
            products.splice(idx, 0, moved);
            dragSrcIndex = null;
            saveProductsToDB();
            renderAdminPanel();
        };
        window.onAdminProductDragEnd = function (e) {
            e.currentTarget.style.opacity = '1';
            dragSrcIndex = null;
        };
        // ÿ≤ÿ± ÿ•ÿÆŸÅÿßÿ°/ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨
        window.toggleHideProduct = function (i) {
            products[i].hidden = !products[i].hidden;
            saveProductsToDB();
            renderAdminProductsList();
        }
        // ÿ™ÿπÿØŸäŸÑ ŸÖŸÜÿ™ÿ¨
        window.editProduct = function (i) {
            showProductForm(i);
        }
        // ÿ≠ÿ∞ŸÅ ŸÖŸÜÿ™ÿ¨
        window.deleteProduct = function (i) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü')) {
                products.splice(i, 1);
                saveProductsToDB();
                renderAdminProductsList();
            }
        }
        // ÿ±ÿ®ÿ∑ ÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑŸÜÿßÿ® ÿ®ÿßÿ±
        document.querySelectorAll('.navbar li[data-section]').forEach(li => {
            li.onclick = function () {
                document.querySelectorAll('.navbar li').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                // ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ŸÉŸÑ ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿ≥ŸÅŸÑŸä ŸÑŸäÿµÿ®ÿ≠ "Home" ŸáŸà ÿßŸÑŸÖŸÅÿπŸÑ ÿπŸÜÿØ ÿßÿÆÿ™Ÿäÿßÿ± ŸÇÿ≥ŸÖ ŸÖŸÜÿ™ÿ¨ÿßÿ™
                document.querySelectorAll('.bottom-nav-item').forEach(item => item.classList.remove('active'));
                const homeItem = document.querySelector('.bottom-nav-item.home-item');
                if (homeItem) homeItem.classList.add('active');

                // ÿßŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÇÿ≥ŸÖ
                document.getElementById('searchInput').value = '';
                window.currentSearchTerm = '';
                const section = this.getAttribute('data-section');
                if (section === 'admin') {
                    showAdminLogin();
                } else {
                    renderProductsSection(section);
                }
            }
        });
        // ÿπÿ±ÿ∂ ŸÇÿ≥ŸÖ man ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿß
        renderProductsSection('man');
        // ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ÿπŸÑŸâ
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        window.addEventListener('scroll', function () {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > navbar.offsetHeight + 30) {
                scrollTopBtn.style.display = 'flex';
                scrollTopBtn.style.opacity = '1';
            } else {
                scrollTopBtn.style.opacity = '0';
                setTimeout(() => { scrollTopBtn.style.display = 'none'; }, 300);
            }
        });
        scrollTopBtn.onclick = function () {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±
        window.currentSearchTerm = '';
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', function () {
                window.currentSearchTerm = this.value;
                // ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
                const activeSection = document.querySelector('.navbar li.active')?.getAttribute('data-section') || 'man';
                renderProductsSection(activeSection);
            });
        }
        // ÿ≤ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ® ÿßŸÑÿπÿßÿ¶ŸÖ
        const whatsappBtn = document.getElementById('whatsappBtn');
        if (whatsappBtn) {
            whatsappBtn.onclick = function () {
                window.open('https://wa.me/201121366757', '_blank');
            };
        }
    </script>
    <!-- Splash Screen Animation -->
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            const splash = document.getElementById('splashScreen');
            const logo = document.getElementById('splashLogo');
            const loader = document.getElementById('mainLoader');
            if (splash && logo) {
                // Step 1: Shake
                logo.style.animation = 'shake 0.7s cubic-bezier(.36,.07,.19,.97) both';
                setTimeout(() => {
                    // Step 2: Drop Down
                    logo.style.animation = 'dropDown 0.9s cubic-bezier(.36,.07,.19,.97) forwards';
                    setTimeout(() => {
                        // Step 3: Hide splash and show page
                        splash.style.opacity = '0';
                        setTimeout(() => {
                            splash.style.display = 'none';
                            // ÿ®ÿπÿØ ÿßÿÆÿ™ŸÅÿßÿ° ÿßŸÑŸÑŸàÿ¨Ÿàÿå ÿ£ÿ∏Ÿáÿ± ÿßŸÑŸÑŸàÿØÿ±
                            if (loader) {
                                loader.style.display = 'flex';
                                loader.style.opacity = '1';
                            }
                        }, 400);
                    }, 900);
                }, 700);
            }
        });
    </script>
    <script>
        // --- ŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ≥ŸÑÿ© ---
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        let cartShakeInterval = null;
        function updateCartCount() {
            const cartCountEl = document.getElementById('cartCount');
            if (cartCountEl) cartCountEl.innerText = cart.length;

            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                cartBadge.innerText = cart.length;
                cartBadge.style.display = cart.length > 0 ? 'flex' : 'none';
            }

            // ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿßŸÑÿ≥ŸÑÿ© ŸÉŸÑ 3 ÿ´ŸàÿßŸÜŸä ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ≥ŸÑÿ© ÿ∫Ÿäÿ± ŸÅÿßÿ±ÿ∫ÿ©
            const cartBtn = document.querySelector('.bottom-nav-item.cart-item');
            if (cart.length > 0) {
                if (!cartShakeInterval) {
                    cartShakeInterval = setInterval(() => {
                        if (cartBtn) {
                            cartBtn.classList.add('shake-cart');
                            setTimeout(() => cartBtn.classList.remove('shake-cart'), 600);
                        }
                    }, 3000);
                }
            } else {
                if (cartShakeInterval) {
                    clearInterval(cartShakeInterval);
                    cartShakeInterval = null;
                }
            }
            // ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ© ŸÅŸä localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
        }
        function addToCart(prod) {
            // ÿ£ÿ∂ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÉŸÖÿß ŸáŸà (ÿ≠ÿ™Ÿâ ŸÑŸà ÿßŸÑÿßÿ≥ŸÖ ŸàÿßŸÑŸÜŸàÿπ ŸÖÿ™ŸÉÿ±ÿ±ŸäŸÜ)
            cart.push({ ...prod, qty: 1 });
            updateCartCount();
            // ÿ±ÿ≥ÿßŸÑÿ© ÿπÿßÿ¶ŸÖÿ©
            showAddToCartMessage(prod.name);
        }
        // ÿπÿ±ÿ∂ ÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ŸÑÿ©
        function renderCartPage() {
            const container = document.getElementById('mainContainer');
            if (cart.length === 0) {
                container.innerHTML = `<div class='section-title'>Shopping Cart</div><div style='text-align:center; padding: 40px; color: #888;'>Your cart is empty.</div>`;
                return;
            }
            let html = `<div class='section-title'>Shopping Cart</div><div class='products-list'>`;
            cart.forEach((item, i) => {
                html += `<div class='product-card' style='flex-direction:row;align-items:center;'>
                    <img src='${((item.images && item.images[0]) ? item.images[0] : '')}' style='width:80px;height:80px;object-fit:cover;border-radius:8px;margin-left:12px;'>
                    <div class='product-info' style='flex:1;'>
                        <div class='product-title'>${item.name}</div>
                        <div class='product-desc'>${item.desc}</div>
                        <div class='product-type'>${item.type}</div>
                        <div class='product-prices'><span>${item.priceAfter} EGP</span></div>
                    </div>
                    <div style='display:flex;flex-direction:column;align-items:center;gap:6px;'>
                        <button onclick='changeCartQty(${i},1)' style='background:#784fe7;color:#fff;border:none;border-radius:50%;width:32px;height:32px;font-size:1.3rem;font-weight:bold;cursor:pointer;'>+</button>
                        <span style='font-size:1.2rem;font-weight:bold;'>${item.qty}</span>
                        <button onclick='changeCartQty(${i},-1)' style='background:#fdeeee;color:#ff4444;border:1px solid #ff4444;border-radius:50%;width:32px;height:32px;font-size:1.3rem;font-weight:bold;cursor:pointer;'>-</button>
                    </div>
                </div>`;
            });
            html += `</div>`;
            // ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿπÿ±
            let total = cart.reduce((sum, item) => sum + (parseFloat(item.priceAfter) * (item.qty || 1)), 0);
            html += `<div style='text-align:center; margin:20px 0;'>
                        <div style='font-size:1.4rem; color:#333; margin-bottom:15px; font-weight:bold;'>
                            Total Price: <span style='color:#784fe7;'>${total} EGP</span>
                        </div>
                        <button onclick='showOrderForm()' class='btn-modern' style='background: linear-gradient(135deg, #784fe7 0%, #a1589e 100%); color:#fff; border:none; padding:15px 40px; border-radius:30px; font-size:1.2rem; font-weight:bold; cursor:pointer; box-shadow: 0 4px 15px rgba(120, 79, 231, 0.3); transition: transform 0.2s;'>
                            Checkout
                        </button>
                    </div>`;
            container.innerHTML = html;
        }
        function changeCartQty(idx, delta) {
            cart[idx].qty += delta;
            if (cart[idx].qty <= 0) cart.splice(idx, 1);
            updateCartCount();
            renderCartPage();
        }
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØ ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        updateCartCount();

        // --- ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ŸäŸÖŸäŸÑ ÿ®ÿßŸÑÿ∑ŸÑÿ® ÿπÿ®ÿ± EmailJS ---
        function sendOrderEmail(order) {
            try {
                const serviceID = 'service_f1mtwbs';
                const templateID = 'template_5g3vdet';
                const publicKey = 'Tn1GtoTbKIshwqxk2';

                // ÂàùÂßãÂåñ EmailJS
                emailjs.init({
                    publicKey: publicKey,
                });

                // ÿ™ŸÜÿ≥ŸäŸÇ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£Ÿàÿ±ÿØÿ±
                const itemsList = order.items.map(item => `- ${item.name} (${item.qty} x ${item.priceAfter} EGP)`).join('\n');

                const templateParams = {
                    to_email: 'ah7med747@gmail.com',
                    customer_name: order.name,
                    customer_phone: order.whatsapp,
                    customer_address: order.address,
                    customer_governorate: order.governorate,
                    order_items: itemsList,
                    order_total: order.total + ' EGP',
                    order_gift: order.gift || 'ÿ®ÿØŸàŸÜ ŸáÿØŸäÿ©',
                    order_time: order.time,
                    discount_code: order.discountCode || 'ŸÑÿß ŸäŸàÿ¨ÿØ'
                };

                emailjs.send(serviceID, templateID, templateParams)
                    .then(() => {
                        console.log('Order email sent successfully!');
                    }, (err) => {
                        console.error('Failed to send order email:', err);
                        // ÿπÿ±ÿ∂ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿÆÿ∑ÿ£ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿßŸÑÿ™ÿ¥ÿÆŸäÿµ
                        if (err.status === 400) {
                            console.error('EmailJS 400 Error: Please check if the Template ID and variable names match exactly.');
                        }
                    });
            } catch (error) {
                console.error('Error in sendOrderEmail function:', error);
            }
        }

        // --- ŸÅŸàÿ±ŸÖ ÿßŸÑÿ∑ŸÑÿ® ---
        function showOrderForm() {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®</div>
                <form id='orderForm' class='order-form-modern'>
                    <div class='form-group'>
                        <input type='text' name='name' id='orderName' placeholder=' ' required autocomplete='off'/>
                        <label for='orderName'>ÿßŸÑÿßÿ≥ŸÖ</label>
                    </div>
                    <div class='form-group'>
                        <input type='text' id='whatsappInput' name='whatsapp' placeholder=' ' required maxlength='11' pattern='[0-9]{11}' autocomplete='off'/>
                        <label for='whatsappInput'>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</label>
                        <div id='whatsappError' class='error-msg' style='display:none;'></div>
                    </div>
                    <div class='form-group' style='position:relative;'>
                        <input type='text' name='governorate' id='governorateInput' placeholder=' ' required autocomplete='off' />
                        <label for='governorateInput'>ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</label>
                        <svg class="dropdown-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>
                        <div id='governorateError' class='error-msg' style='display:none;'></div>
                        <ul id='governorateList' style='position:absolute;top:100%;right:0;left:0;z-index:100;background:#fff;border:1.5px solid #eec9d2;border-radius:12px;max-height:250px;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,0.1);display:none;margin:4px 0 0 0;padding:8px 0;list-style:none;'></ul>
                    </div>
                    <div class='form-group'>
                        <textarea name='address' id='orderAddress' placeholder=' ' required></textarea>
                        <label for='orderAddress'>ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ</label>
                    </div>
                    <div class='form-group'>
                        <input type='text' id='discountCodeInput' name='discountCode' placeholder=' ' maxlength='6'/>
                        <label for='discountCodeInput'>ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàÿØ ÿÆÿµŸÖ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <div id='discountCodeMsg' class='success-msg' style='display:none;'></div>
                        <div id='discountCodeError' class='error-msg' style='display:none;'></div>
                    </div>
                    <div id='orderTotalBox'></div>
                    <button type='submit'>ÿ™ÿ£ŸÉŸäÿØ ŸÜŸáÿßÿ¶Ÿä ŸÑŸÑÿ∑ŸÑÿ®</button>
                </form>
                <br>
                <div id='giftSection'></div>`;
            container.innerHTML = html;
            // ÿ™ÿ≠ŸÇŸÇ ŸÖÿ®ÿßÿ¥ÿ± ÿπŸÜÿØ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
            const whatsappInput = document.getElementById('whatsappInput');
            const whatsappError = document.getElementById('whatsappError');
            whatsappInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (this.value.length > 11) this.value = this.value.slice(0, 11);
                if (this.value.length === 11) {
                    whatsappError.style.display = 'none';
                }
            });
            // ÿ™ÿ≠ŸÇŸÇ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©
            const governorateInput = document.getElementById('governorateInput');
            const governorateError = document.getElementById('governorateError');
            const governorateList = document.getElementById('governorateList');
            // ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™
            const governorates = [
                'ÿßŸÑŸÇÿßŸáÿ±ÿ©', 'ÿßŸÑÿ¨Ÿäÿ≤ÿ©', 'ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©', 'ÿßŸÑÿØŸÇŸáŸÑŸäÿ©', 'ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©', 'ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©', 'ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©', 'ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©', 'ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©', 'ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ', 'ÿßŸÑŸÅŸäŸàŸÖ', 'ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ', 'ÿßŸÑŸÖŸÜŸäÿß', 'ÿ£ÿ≥ŸäŸàÿ∑', 'ÿ≥ŸàŸáÿßÿ¨', 'ŸÇŸÜÿß', 'ÿßŸÑÿ£ŸÇÿµÿ±', 'ÿ£ÿ≥ŸàÿßŸÜ', 'ÿØŸÖŸäÿßÿ∑', 'ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ', 'ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©', 'ÿßŸÑÿ≥ŸàŸäÿ≥', 'ŸÖÿ∑ÿ±Ÿàÿ≠', 'ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°', 'ÿ¨ŸÜŸàÿ® ÿ≥ŸäŸÜÿßÿ°', 'ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ', 'ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±'
            ];
            // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿπŸÜÿØ ÿßŸÑŸÉÿ™ÿßÿ®ÿ© ÿ£Ÿà ÿßŸÑÿ∂ÿ∫ÿ∑
            function showGovList() {
                const val = governorateInput.value.trim();
                let filtered = governorates.filter(g => g.includes(val));
                if (!val) filtered = governorates;
                if (filtered.length) {
                    governorateList.innerHTML = filtered.map(g => `<li style='padding:12px 16px;cursor:pointer;font-size:1.1rem;color:#5a4e7c;transition:background 0.2s,color 0.2s;' data-gov='${g}'>${g}</li>`).join('');
                    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸáŸàŸÅÿ± ÿ®ÿ±ŸÖÿ¨ŸäÿßŸã ÿ£Ÿà ÿπÿ®ÿ± CSS (ÿ≥ŸÜÿ∂ŸäŸÅ ÿßŸÑŸÄ CSS ŸÑŸÑŸÄ li ŸáŸÜÿß)
                    governorateList.querySelectorAll('li').forEach(li => {
                        li.onmouseover = () => { li.style.background = '#fdf2fec2'; li.style.color = '#a1589e'; };
                        li.onmouseout = () => { li.style.background = ''; li.style.color = ''; };
                    });
                    governorateList.style.display = 'block';
                } else {
                    governorateList.style.display = 'none';
                }
            }
            governorateInput.addEventListener('input', showGovList);
            governorateInput.addEventListener('focus', showGovList);
            governorateInput.addEventListener('click', showGovList);
            // ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            governorateList.addEventListener('mousedown', function (e) {
                if (e.target.tagName === 'LI') {
                    governorateInput.value = e.target.getAttribute('data-gov');
                    governorateList.style.display = 'none';
                    updateOrderTotal();
                }
            });
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿπŸÜÿØ ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
            governorateInput.addEventListener('blur', function () {
                setTimeout(() => { governorateList.style.display = 'none'; }, 150);
            });
            // --- ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ ---
            let discountValue = 0;
            let discountCodeUsed = '';
            const discountCodeInput = document.getElementById('discountCodeInput');
            const discountCodeMsg = document.getElementById('discountCodeMsg');
            const discountCodeError = document.getElementById('discountCodeError');
            const orderTotalBox = document.getElementById('orderTotalBox');
            // ÿßŸÑÿ¥ÿ≠ŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©
            let shippingValue = 0;
            let shippingText = '';
            // --- ÿ¨ÿ≤ÿ° ÿßŸÑŸáÿØÿßŸäÿß ---
            let selectedGift = '';
            function renderGiftSection(total) {
                const giftSection = document.getElementById('giftSection');
                if (!giftSection) return;
                if (total >= 1000) {
                    // ÿ®ŸÜÿßÿ° ÿµŸàÿ± ÿßŸÑŸáÿØÿßŸäÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã
                    giftSection.innerHTML = '';
                    const title = document.createElement('div');
                    title.style.marginBottom = '8px';
                    title.style.fontWeight = 'bold';
                    title.style.color = '#a1589e';
                    title.style.textAlign = 'center';
                    title.textContent = 'ÿßÿÆÿ™ÿ± ŸáÿØŸäÿ™ŸÉ ( ÿπŸÜÿØ ÿßŸÑÿ¥ÿ±ÿßÿ° ÿ®ŸÄ 1000 ÿ¨ŸÜŸäŸá ÿ£Ÿà ÿ£ŸÉÿ´ÿ± )';
                    giftSection.appendChild(title);
                    const row = document.createElement('div');
                    row.className = 'gift-row';
                    row.style.display = 'flex';
                    row.style.flexDirection = 'row';
                    row.style.gap = '16px';
                    row.style.justifyContent = 'center';
                    row.style.alignItems = 'center';
                    row.style.marginBottom = '10px';
                    const gifts = ['img1.jpg', 'img2.jpg', 'img3.jpg'];
                    gifts.forEach(function (img) {
                        const label = document.createElement('label');
                        label.style.cursor = 'pointer';
                        label.style.display = 'flex';
                        label.style.flexDirection = 'column';
                        label.style.alignItems = 'center';
                        const input = document.createElement('input');
                        input.type = 'radio';
                        input.name = 'gift';
                        input.value = img;
                        input.style.display = 'none';
                        const image = document.createElement('img');
                        image.src = img;
                        image.style.width = '70px';
                        image.style.height = '70px';
                        image.style.objectFit = 'cover';
                        image.style.borderRadius = '8px';
                        image.style.border = '2px solid #eec9d2';
                        image.style.transition = 'box-shadow 0.2s';
                        image.className = 'gift-img';
                        label.appendChild(input);
                        label.appendChild(image);
                        row.appendChild(label);
                    });
                    giftSection.appendChild(row);
                    const errorDiv = document.createElement('div');
                    errorDiv.id = 'giftError';
                    errorDiv.className = 'error-msg';
                    errorDiv.style.display = 'none';
                    giftSection.appendChild(errorDiv);
                    // ÿ™ŸÅÿπŸäŸÑ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑ ŸÖÿπ ÿ™ŸÖŸäŸäÿ≤Ÿáÿß
                    giftSection.querySelectorAll('input[name="gift"]').forEach(input => {
                        input.addEventListener('change', function () {
                            selectedGift = this.value;
                            giftSection.querySelectorAll('.gift-img').forEach(img => img.style.boxShadow = '');
                            this.nextElementSibling.style.boxShadow = '0 0 0 4px #a1589e';
                        });
                    });
                } else {
                    giftSection.innerHTML = '';
                    selectedGift = '';
                }
            }
            function updateOrderTotal() {
                let total = cart.reduce((sum, item) => sum + (parseFloat(item.priceAfter) * (item.qty || 1)), 0);
                let afterDiscount = Math.max(0, total - discountValue);
                // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ¥ÿ≠ŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©
                const gov = governorateInput.value.trim();
                // ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™ ÿ®ÿ≥ÿπÿ± 85 ÿ¨ŸÜŸäŸá
                const gov85 = ['ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©', 'ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©', 'ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©', 'ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©', 'ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©', 'ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ', 'ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©', 'ÿßŸÑÿ≥ŸàŸäÿ≥', 'ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ'];
                // ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™ ÿ®ÿ≥ÿπÿ± 99 ÿ¨ŸÜŸäŸá
                const gov99 = ['ÿßŸÑÿ£ŸÇÿµÿ±', 'ÿ£ÿ≥ŸàÿßŸÜ', 'ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ', 'ÿ≥ŸàŸáÿßÿ¨', 'ÿßŸÑŸÖŸÜŸäÿß', 'ÿ£ÿ≥ŸäŸàÿ∑', 'ÿ¥ÿ±ŸÖ ÿßŸÑÿ¥ŸäÿÆ', 'ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°', 'ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±', 'ŸÇŸÜÿß', 'ŸÖÿ±ÿ≥Ÿä ŸÖÿ∑ÿ±Ÿàÿ≠', 'ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ', 'ÿßŸÑŸÅŸäŸàŸÖ', 'ŸÖÿ±ÿ≥Ÿä ÿπŸÑŸÖ'];
                if (gov === 'ÿßŸÑŸÇÿßŸáÿ±ÿ©') {
                    shippingValue = 70;
                    shippingText = ' (70 ÿ¨ŸÜŸäŸá ŸÑŸÑÿ¥ÿ≠ŸÜ)';
                } else if (gov === 'ÿßŸÑÿ¨Ÿäÿ≤ÿ©') {
                    shippingValue = 75;
                    shippingText = ' (75 ÿ¨ŸÜŸäŸá ŸÑŸÑÿ¥ÿ≠ŸÜ)';
                } else if (gov85.includes(gov)) {
                    shippingValue = 85;
                    shippingText = ' (85 ÿ¨ŸÜŸäŸá ŸÑŸÑÿ¥ÿ≠ŸÜ)';
                } else if (gov99.includes(gov)) {
                    shippingValue = 99;
                    shippingText = ' (99 ÿ¨ŸÜŸäŸá ŸÑŸÑÿ¥ÿ≠ŸÜ)';
                } else if (gov && governorates.includes(gov)) {
                    shippingValue = 85;
                    shippingText = ' (85 ÿ¨ŸÜŸäŸá ŸÑŸÑÿ¥ÿ≠ŸÜ)';
                } else {
                    shippingValue = 0;
                    shippingText = '';
                }
                let finalTotal = afterDiscount + shippingValue;
                if (discountValue > 0) {
                    orderTotalBox.innerHTML = `ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿ®ÿπÿØ ÿßŸÑÿÆÿµŸÖ${shippingText}: <span style='color:#25d366;'>${finalTotal} </span> <del style='color:#ff4444;font-size:1rem;margin-right:8px;'>${total + shippingValue} </del>`;
                } else {
                    orderTotalBox.innerHTML = `ÿ¨.ŸÖ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿπÿ±${shippingText}: <span style='color:#ff2a04;'>${finalTotal}</span>`;
                }
                renderGiftSection(finalTotal);
            }
            updateOrderTotal();
            governorateInput.addEventListener('input', updateOrderTotal);
            discountCodeInput.addEventListener('input', function () {
                const code = this.value.trim().toUpperCase();
                discountCodeMsg.style.display = 'none';
                discountCodeError.style.display = 'none';
                discountValue = 0;
                discountCodeUsed = '';
                if (code.length === 6) {
                    firebase.database().ref('discountCodes/' + code).once('value', snap => {
                        if (!snap.exists()) {
                            discountCodeError.innerText = 'ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠.';
                            discountCodeError.style.display = 'block';
                            updateOrderTotal();
                            return;
                        }
                        const d = snap.val();
                        if (new Date(d.expires) < new Date()) {
                            discountCodeError.innerText = 'ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ.';
                            discountCodeError.style.display = 'block';
                            updateOrderTotal();
                            return;
                        }
                        if ((d.usedCount || 0) >= (d.maxUses || 1)) {
                            discountCodeError.innerText = 'ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ ŸÖŸÜ ŸÇÿ®ŸÑ.';
                            discountCodeError.style.display = 'block';
                            updateOrderTotal();
                            return;
                        }
                        discountValue = parseFloat(d.amount);
                        discountCodeUsed = d.code;
                        discountCodeMsg.innerText = `ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ (${d.code}) Ÿàÿ™ŸÖ ÿÆÿµŸÖ ${d.amount} ÿ¨ŸÜŸäŸá.`;
                        discountCodeMsg.style.display = 'block';
                        updateOrderTotal();
                    });
                } else {
                    updateOrderTotal();
                }
            });
            // ---
            document.getElementById('orderForm').onsubmit = function (e) {
                e.preventDefault();
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®
                const val = whatsappInput.value;
                if (!/^[0-9]{11}$/.test(val)) {
                    whatsappError.innerText = 'ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ® Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 11 ÿ±ŸÇŸÖŸãÿß (ÿ£ÿ±ŸÇÿßŸÖ ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ŸÅŸÇÿ∑)';
                    whatsappError.style.display = 'block';
                    whatsappInput.focus();
                    return;
                } else {
                    whatsappError.style.display = 'none';
                }
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©
                const govVal = governorateInput.value.trim();
                if (!govVal || !governorates.includes(govVal)) {
                    governorateError.innerText = 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©.';
                    governorateError.style.display = 'block';
                    governorateInput.focus();
                    return;
                } else {
                    governorateError.style.display = 'none';
                }
                const fd = new FormData(this);
                let total = cart.reduce((sum, item) => sum + (parseFloat(item.priceAfter) * (item.qty || 1)), 0);
                let afterDiscount = Math.max(0, total - discountValue);
                // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ¥ÿ≠ŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©
                let shipping = 0;
                const gov85 = ['ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©', 'ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©', 'ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©', 'ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©', 'ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©', 'ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ', 'ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©', 'ÿßŸÑÿ≥ŸàŸäÿ≥', 'ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ'];
                const gov99 = ['ÿßŸÑÿ£ŸÇÿµÿ±', 'ÿ£ÿ≥ŸàÿßŸÜ', 'ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ', 'ÿ≥ŸàŸáÿßÿ¨', 'ÿßŸÑŸÖŸÜŸäÿß', 'ÿ£ÿ≥ŸäŸàÿ∑', 'ÿ¥ÿ±ŸÖ ÿßŸÑÿ¥ŸäÿÆ', 'ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°', 'ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±', 'ŸÇŸÜÿß', 'ŸÖÿ±ÿ≥Ÿä ŸÖÿ∑ÿ±Ÿàÿ≠', 'ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ', 'ÿßŸÑŸÅŸäŸàŸÖ', 'ŸÖÿ±ÿ≥Ÿä ÿπŸÑŸÖ'];
                if (govVal === 'ÿßŸÑŸÇÿßŸáÿ±ÿ©') shipping = 70;
                else if (govVal === 'ÿßŸÑÿ¨Ÿäÿ≤ÿ©') shipping = 75;
                else if (gov85.includes(govVal)) shipping = 85;
                else if (gov99.includes(govVal)) shipping = 99;
                else if (governorates.includes(govVal)) shipping = 85;
                let finalTotal = afterDiscount + shipping;
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ŸáÿØŸäÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ¨ŸÖŸàÿπ 1000 ÿ£Ÿà ÿ£ŸÉÿ´ÿ±
                if (finalTotal >= 1000) {
                    selectedGift = document.querySelector('input[name="gift"]:checked')?.value || '';
                    if (!selectedGift) {
                        document.getElementById('giftError').innerText = 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸáÿØŸäÿ©.';
                        document.getElementById('giftError').style.display = 'block';
                        return;
                    } else {
                        document.getElementById('giftError').style.display = 'none';
                    }
                }
                const order = {
                    name: fd.get('name'),
                    whatsapp: fd.get('whatsapp'),
                    address: fd.get('address'),
                    governorate: govVal,
                    items: cart.map(item => ({ ...item })),
                    total: finalTotal,
                    shipping: shipping,
                    discountCode: discountCodeUsed || '',
                    discountValue: discountValue,
                    gift: selectedGift,
                    time: new Date().toLocaleString(),
                    timestamp: Date.now()
                };
                // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÜÿ®ŸäŸá ÿ®ÿßŸÑÿ•ŸäŸÖŸäŸÑ
                sendOrderEmail(order);

                saveOrderToDB(order);
                // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÉŸàÿØ ÿÆÿµŸÖÿå ÿ≤ÿØ usedCount ÿ®ŸÖŸÇÿØÿßÿ± 1
                if (discountCodeUsed) {
                    const codeRef = firebase.database().ref('discountCodes/' + discountCodeUsed + '/usedCount');
                    codeRef.transaction(current => (current || 0) + 1);
                }
                showOrderSummary(order);
                cart = [];
                updateCartCount();
            };
        }
        function showOrderSummary(order) {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠</div>`;

            html += `<div style='max-width:500px;margin:0 auto;background:#ecf1eb;padding:18px 20px;border-radius:10px; direction:rtl; font-size:1.4rem'>`;
            html += `<div style='margin-bottom:10px; text-align:center; color:#a1589e;'><b>ÿ≥ŸàŸÅ Ÿäÿ™ŸÖ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÅŸä ÿßÿ≥ÿ±ÿπ ŸàŸÇÿ™ !!</b> </div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿßŸÑÿßÿ≥ŸÖ:</b> ${order.name}</div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®:</b> ${order.whatsapp}</div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿßŸÑÿπŸÜŸàÿßŸÜ:</b> ${order.address}</div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:</b> <span style='color:#ff2a04;'>${order.total} ÿ¨.ŸÖ</span></div>`;
            html += `<div style='margin-top:18px;text-align:center;'><button onclick='renderProductsSection("man")' style='background:#a1589e;color:#ffffff;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button></div>`;
            html += `</div>`;
            container.innerHTML = html;
        }
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function saveOrderToDB(order) {
            // ÿßÿ≥ÿ™ÿÆÿØŸÖ orders ŸÉÿ¨ÿ∞ÿ±
            const ordersRef = firebase.database().ref('orders');
            const newOrderRef = ordersRef.push();
            const orderId = newOrderRef.key;
            newOrderRef.set(order);

            // ÿ≠ŸÅÿ∏ ID ÿßŸÑÿ∑ŸÑÿ® ŸÅŸä ÿßŸÑÿ¨Ÿáÿßÿ≤
            let myOrderIds = JSON.parse(localStorage.getItem('myOrderIds') || '[]');
            myOrderIds.push(orderId);
            localStorage.setItem('myOrderIds', JSON.stringify(myOrderIds));
        }

        // --- ŸÇÿ≥ŸÖ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä (Profile) ---
        function renderProfileSection() {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>Profile</div>`;

            let myOrderIds = JSON.parse(localStorage.getItem('myOrderIds') || '[]');

            if (myOrderIds.length === 0) {
                html += `<div style='text-align:center; padding: 40px 20px;'>
                    <svg viewBox="0 0 24 24" style="width:80px;height:80px;fill:#ccc;margin-bottom:10px;"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    <div style='font-size:1.2rem; color:#888;'>No orders found for this device.</div>
                </div>`;
                container.innerHTML = html;
                return;
            }

            html += `<div style='max-width:600px; margin:0 auto;' id='myOrdersContainer'>
                <div style='font-size:1.1rem; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px; color:#784fe7; font-weight:bold; text-align:left;'>Orders (Last 10 Days)</div>
                <div id="profileLoadingMsg" style='text-align:center; padding: 20px;'>Loading orders...</div>
            </div>`;
            container.innerHTML = html;

            const myOrdersContainer = document.getElementById('myOrdersContainer');
            let activeIDs = [...myOrderIds].reverse();

            const ordersRef = firebase.database().ref('orders');
            ordersRef.once('value', snapshot => {
                const allOrders = snapshot.val() || {};
                let ordersHtml = `<div style='font-size:1.1rem; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px; color:#784fe7; font-weight:bold; text-align:left;'>Orders (Last 10 Days)</div>`;

                let foundOrders = false;
                const tenDaysAgo = new Date();
                tenDaysAgo.setDate(tenDaysAgo.getDate() - 10);

                activeIDs.forEach(id => {
                    const order = allOrders[id];
                    if (order) {
                        // ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ (ÿ¢ÿÆÿ± 10 ÿ£ŸäÿßŸÖ)
                        let orderDate = parseOrderDate(order.time);
                        let isRecent = false;
                        if (order.timestamp) {
                            isRecent = (Date.now() - order.timestamp) <= (10 * 24 * 60 * 60 * 1000);
                        } else if (orderDate) {
                            isRecent = orderDate >= tenDaysAgo;
                        } else {
                            // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÜÿ¨ÿ≠ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿå ŸÜÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ® ÿßÿ≠ÿ™Ÿäÿßÿ∑ÿßŸã ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿÆÿ≤ŸÜÿßŸã ŸÖÿ≠ŸÑŸäÿßŸã
                            isRecent = true;
                        }

                        if (!isRecent) return;

                        foundOrders = true;
                        let statusColor = '#784fe7'; // Pending
                        let statusText = order.status || 'Pending';
                        if (statusText === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ') statusText = 'Delivered';
                        if (statusText === 'ŸÖŸÑÿ∫Ÿä') statusText = 'Cancelled';

                        if (statusText === 'Delivered') statusColor = '#25d366';
                        if (statusText === 'Cancelled') statusColor = '#ff4444';

                        ordersHtml += `
                        <div style='background:#fff; border-radius:15px; box-shadow:0 6px 18px rgba(0,0,0,0.06); padding:18px; margin-bottom:18px; border-left:6px solid ${statusColor}; direction:ltr; text-align:left;'>
                            <div style='display:flex; justify-content:space-between; margin-bottom:12px; align-items:center;'>
                                <span style='font-weight:bold; color:#333; font-size:1.15rem;'>Order ID: <span style='font-size:0.85rem; color:#784fe7;'>${id.slice(-6)}</span></span>
                                <span style='background:${statusColor}15; color:${statusColor}; padding:6px 12px; border-radius:20px; font-size:0.85rem; font-weight:bold; border:1px solid ${statusColor}30;'>${statusText}</span>
                            </div>
                            
                            <div style='display:flex; flex-wrap:wrap; gap:15px; color:#555; font-size:0.95rem; margin-bottom:12px; background:#fafafa; padding:10px; border-radius:10px;'>
                                <div style='display:flex; align-items:center; gap:6px;'>
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                    <b>${order.time.split(',')[0]}</b>
                                </div>
                                <div style='display:flex; align-items:center; gap:6px;'>
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                                    <b style='color:#784fe7;'>${order.total} EGP</b>
                                </div>
                            </div>

                            <div style='border-top:1px dashed #eee; padding-top:12px;'>
                                <div style='font-weight:bold; margin-bottom:8px; font-size:0.9rem; color:#888;'>Items:</div>
                                <div style='display:flex; gap:12px; overflow-x:auto; padding-bottom:8px;'>
                                    ${order.items.map(item => `
                                        <div style='min-width:70px; text-align:center;'>
                                            <img src='${((item.images && item.images[0]) ? item.images[0] : '')}' style='width:60px; height:60px; object-fit:cover; border-radius:10px; border:1px solid #f0f0f0; box-shadow: 0 2px 5px rgba(0,0,0,0.05);'>
                                            <div style='font-size:0.75rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:70px; margin-top:4px; color:#444;'>${item.name}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>`;
                    }
                });

                if (!foundOrders) {
                    ordersHtml += `<div style='text-align:center; padding: 40px 20px;'>
                        <div style='font-size:1.1rem; color:#888;'>No orders found in the last 10 days.</div>
                    </div>`;
                }

                if (myOrdersContainer) myOrdersContainer.innerHTML = ordersHtml;
            }).catch(err => {
                const msg = document.getElementById('profileLoadingMsg');
                if (msg) msg.innerText = "An error occurred while loading data.";
                console.error("Profile load error:", err);
            });
        }

        // --- ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿ≥ŸÅŸÑŸä ---
        function switchNav(el, section) {
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ŸÉŸÑ
            document.querySelectorAll('.bottom-nav-item').forEach(item => item.classList.remove('active'));
            el.classList.add('active');

            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
            if (section === 'home') {
                // ÿ™ŸÅÿπŸäŸÑ ÿ£ŸàŸÑ ŸÇÿ≥ŸÖ ŸÅŸä ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿπŸÑŸàŸä
                const firstSection = document.querySelector('.navbar li[data-section]:not(#adminBtn)');
                if (firstSection) firstSection.click();
            } else if (section === 'cart') {
                renderCartPage();
                // ÿ•ŸÑÿ∫ÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿπŸÑŸàŸä
                document.querySelectorAll('.navbar li').forEach(l => l.classList.remove('active'));
            } else if (section === 'favorites') {
                renderFavoritesSection();
                // ÿ•ŸÑÿ∫ÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿπŸÑŸàŸä
                document.querySelectorAll('.navbar li').forEach(l => l.classList.remove('active'));
            } else if (section === 'profile') {
                renderProfileSection();
                // ÿ•ŸÑÿ∫ÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÜÿßŸÅ ÿ®ÿßÿ± ÿßŸÑÿπŸÑŸàŸä
                document.querySelectorAll('.navbar li').forEach(l => l.classList.remove('active'));
            }
        }
        window.switchNav = switchNav;
    </script>
    <script>
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿπÿßÿ¶ŸÖÿ© ÿ®ÿπÿØ addToCart ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        function showAddToCartMessage(productName) {
            const msg = document.getElementById('addToCartMsg');
            if (msg) {
                msg.innerText = ` ! ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ© "${productName}" ÿ™ŸÖ ÿßÿ∂ÿßŸÅÿ© `;
                msg.classList.add('show');
                clearTimeout(msg._hideTimeout);
                msg._hideTimeout = setTimeout(() => msg.classList.remove('show'), 1500);
            }
        }
        // ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸÑŸÑŸÅŸÑÿ™ÿ±ÿ©
        let currentOrdersData = [];

        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ÿßŸÑÿ£ÿØŸÖŸÜ
        function renderOrdersList() {
            const listContainer = document.getElementById('ordersList');
            if (!listContainer) return;

            // ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿµÿ± ÿßŸÑŸÅŸÑÿ™ÿ±
            listContainer.innerHTML = `
                <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; justify-content: flex-end;">
                    <label style="font-weight: bold; color: #555;">Filter by Status:</label>
                    <select id="orderStatusFilter" onchange="applyOrderFilter()" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; cursor: pointer;">
                        <option value="all">All Orders</option>
                        <option value="pending">Pending (ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±)</option>
                        <option value="delivered">Delivered (ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ)</option>
                        <option value="cancelled">Cancelled (ŸÖŸÑÿ∫Ÿä)</option>
                    </select>
                </div>
                <div id="ordersTableContainer" style="min-height: 200px;">Loading orders...</div>
            `;

            const ordersRef = firebase.database().ref('orders');
            ordersRef.on('value', snapshot => {
                const val = snapshot.val() || {};
                currentOrdersData = Object.entries(val); // [id, order]
                applyOrderFilter();
            });
        }

        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿ™ÿ± Ÿàÿπÿ±ÿ∂ ÿßŸÑÿ¨ÿØŸàŸÑ
        function applyOrderFilter() {
            const container = document.getElementById('ordersTableContainer');
            if (!container) return;
            const filter = document.getElementById('orderStatusFilter')?.value || 'all';

            // ŸÜÿ≥ÿÆ ŸàÿπŸÉÿ≥ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® (ÿßŸÑÿ£ÿ≠ÿØÿ´ ÿ£ŸàŸÑÿßŸã)
            let displayList = [...currentOrdersData].reverse();

            // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿ™ÿ±
            if (filter !== 'all') {
                displayList = displayList.filter(([id, order]) => {
                    const status = order.status || 'ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±';
                    if (filter === 'pending') return status === 'ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±' || status === 'Pending';
                    if (filter === 'delivered') return status === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ' || status === 'Delivered';
                    if (filter === 'cancelled') return status === 'ŸÖŸÑÿ∫Ÿä' || status === 'Cancelled';
                    return true;
                });
            }

            if (displayList.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:30px; color:#888; font-size:1.1rem;">No orders found matching this filter.</div>';
                return;
            }

            let html = `<div style='overflow-x:auto;'><table style='width:100%;border-collapse:collapse;background:#232323;border-radius:10px;box-shadow:0 2px 12px #0003;'>
                <thead>
                    <tr style='background:#181818;color:#784fe7;'>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑÿßÿ≥ŸÖ</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑÿπŸÜŸàÿßŸÜ</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑŸáÿØŸäÿ©</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®</th>
                        <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ≠ÿ∞ŸÅ</th>
                    </tr>
                </thead>
                <tbody>`;

            displayList.forEach(([id, order]) => {
                let productsHtml = '';
                if (order.items && order.items.length) {
                    productsHtml = order.items.map(item => `
                        <div style='display:flex;align-items:center;gap:6px;margin-bottom:4px;'>
                            <img src='${(item.images && item.images[0]) ? item.images[0] : ''}' style='width:38px;height:38px;object-fit:cover;border-radius:5px;border:1px solid #784fe7;'>
                            <span style='font-size:1rem;color:#784fe7;font-weight:bold;'>${item.name}</span>
                            <span style='font-size:0.95rem;color:#000000;'>√ó ${item.qty}</span>
                        </div>
                    `).join('');
                }
                html += `<tr style='border-bottom:1px solid #333;background-color:#ecf1eb;'>
                    <td style='padding:8px 6px;'>${order.name}</td>
                    <td style='padding:8px 6px;'>${order.whatsapp}</td>
                    <td style='padding:8px 6px;'>${order.address}</td>
                    <td style='padding:8px 6px;'>${order.governorate || ''}</td>
                    <td style='padding:8px 6px;'>${productsHtml}</td>
                    <td style='padding:8px 6px;'>${order.discountCode ? `${order.discountCode} ${order.discountValue ? `(${order.discountValue} ÿ¨ŸÜŸäŸá)` : ''}` : ''}</td>
                    <td style='padding:8px 6px;color:#784fe7;font-weight:bold;'>${order.total} ÿ¨.ŸÖ</td>
                    <td style='padding:8px 6px;text-align:center;'>${order.gift ? `<img src='${order.gift}' style='width:38px;height:38px;object-fit:cover;border-radius:5px;border:1px solid #b9b4e7;' alt='ŸáÿØŸäÿ©'>` : '-'}</td>
                    <td style='padding:8px 6px;'>${order.time || ''}</td>
                    <td style='padding:8px 6px;'>
                        <select class='order-status-select' data-order-id='${id}' onchange='updateOrderStatus("${id}", this.value)' style='padding:4px 8px;border-radius:6px;font-size:1rem;background:#181818;color:#784fe7;border:1px solid #444;'>
                            <option value='ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±' ${!order.status || order.status === 'ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±' ? 'selected' : ''}>ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</option>
                            <option value='ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ' ${order.status === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ' ? 'selected' : ''}>ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ</option>
                            <option value='ŸÖŸÑÿ∫Ÿä' ${order.status === 'ŸÖŸÑÿ∫Ÿä' ? 'selected' : ''}>ŸÖŸÑÿ∫Ÿä</option>
                        </select>
                    </td>
                    <td style='padding:8px 6px;text-align:center;'>
                        <button onclick='deleteOrder("${id}")' title='ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ®' style='background:none;border:none;cursor:pointer;'>
                            <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M3 6H5H21' stroke='#ff4444' stroke-width='2'/><path d='M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M10 11V17M14 11V17' stroke='#ff4444' stroke-width='2'/></svg>
                        </button>
                    </td>
                </tr>`;
            });
            html += `</tbody></table></div>`;

            container.innerHTML = html;
            styleOrderStatusSelects();
        }

        // ÿßÿ¨ÿπŸÑ ÿßŸÑÿØÿßŸÑÿ© ŸÖÿ™ÿßÿ≠ÿ© ÿπÿßŸÑŸÖŸäÿßŸã
        window.applyOrderFilter = applyOrderFilter;
        // ÿØÿßŸÑÿ© ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ®
        function deleteOrder(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ®ÿü')) {
                firebase.database().ref('orders/' + id).remove();
            }
        }
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®
        function updateOrderStatus(id, status) {
            firebase.database().ref('orders/' + id + '/status').set(status);
            setTimeout(styleOrderStatusSelects, 100); // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸàŸÜ ÿ®ÿπÿØ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±
        }
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ŸÑÿ™ŸÑŸàŸäŸÜ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ≠ÿ≥ÿ® ÿßŸÑÿ≠ÿßŸÑÿ©
        function styleOrderStatusSelects() {
            document.querySelectorAll('.order-status-select').forEach(sel => {
                sel.classList.remove('delivered', 'cancelled', 'pending');
                if (sel.value === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ') {
                    sel.classList.add('delivered');
                } else if (sel.value === 'ŸÖŸÑÿ∫Ÿä') {
                    sel.classList.add('cancelled');
                } else {
                    sel.classList.add('pending');
                }
            });
        }
    </script>
    <style>
        h1 {
            color: #222;
        }
    </style>
    <script>
        // --- ÿπÿ±ÿ∂ ŸÇÿ≥ŸÖ ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ---
        function renderFavoritesSection() {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>Favorites</div>`;
            if (favorites.length === 0) {
                html += `<div style='text-align:center; padding: 40px; color: #888;'>No products in your favorites.</div>`;
            } else {
                html += `<div class='products-grid'>`;
                favorites.forEach((favItem, idx) => {
                    const prod = products.find(p => p.name === favItem.name && p.type === favItem.type);
                    if (!prod) return;
                    const fadeDelay = idx * 60;
                    let slider = '';
                    if (prod.images && prod.images.length > 1) {
                        slider = `
                        <div class='img-slider' style='position:relative;'>
                            <img src='${prod.images[0]}' class='slider-img' style='cursor:pointer;' onclick='showImageModal("${prod.images[0]}")' data-slider-idx='0' data-prod-idx='${idx}'>
                            <button class='slider-btn left' onclick='event.stopPropagation();window.changeSlide(this,${idx},-1)' style='position:absolute;left:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Äπ</button>
                            <button class='slider-btn right' onclick='event.stopPropagation();window.changeSlide(this,${idx},1)' style='position:absolute;right:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Ä∫</button>
                        </div>`;
                    } else {
                        slider = `<img src='${prod.images[0] || ''}' style='cursor:pointer;' onclick='showImageModal("${prod.images[0]}")'>`;
                    }
                    let fav = isFavorite(prod);
                    let heartBtn = `<button onclick='window.toggleFavorite("${prod.name.replace(/"/g, '&quot;')}", "${prod.type}")' style='position:absolute;top:6px;right:0;background:none;border:none;cursor:pointer;z-index:10;'>
                        <svg width='32' height='32' viewBox='0 0 24 24' fill='${fav ? "#ff4444" : "none"}' stroke='#ff4444' stroke-width='2'><path d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/></svg>
                    </button>`;
                    let availableHtml = (prod.available === false) ? `<div style='color:#ff4444;font-weight:bold;margin-top:6px;'>Out of Stock</div>` : '';
                    html += `
                    <div class='product-card' style='overflow:visible; --fade-delay:${fadeDelay}ms;'>
                        <div style='position:relative;'>
                            ${slider}
                            ${heartBtn}
                            ${availableHtml}
                        </div>
                        <div class='product-title'>${prod.name}</div>
                        <div class='product-desc'>${prod.desc}</div>
                        <div class='product-type'>${prod.type}</div>
                        <div class='product-prices'>
                            <del>${prod.priceBefore} EGP</del> <span>${prod.priceAfter} EGP</span>
                        </div>
                        ${(prod.available === false) ? '' : `<button class='add-to-cart-btn' onclick='addToCart(${JSON.stringify(prod)})' style='background:#25d366;color:#fff;font-weight:bold;padding:8px 0;border-radius:6px;width:100%;margin-top:8px;font-size:1.1rem;cursor:pointer;border:none;'>Add to Cart</button>`}
                    </div>
                    `;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }

    </script>
    <script>
        // --- ÿµŸÅÿ≠ÿ© ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿÆÿµŸÖ ŸÅŸä ÿßŸÑÿ£ÿØŸÖŸÜ ---
        function renderDiscountCodesPage() {
            const listContainer = document.getElementById('discountCodesPage');
            if (!listContainer) return;

            listContainer.innerHTML = `
                <div style="display:flex; justify-content:flex-start; align-items:center; margin-bottom:20px; direction:rtl;">
                    <button onclick='showAddDiscountCodeForm()' style='background:#25d366;color:#fff;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿ•ŸÜÿ¥ÿßÿ° ŸÉŸàÿØ ÿÆÿµŸÖ ÿ¨ÿØŸäÿØ</button>
                </div>
                <div id='discountCodesFormContainer'></div>
                <div id='discountCodesList'></div>
            `;

            const actualList = document.getElementById('discountCodesList');
            // ÿ¨ŸÑÿ® ÿßŸÑÿ£ŸÉŸàÿßÿØ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            firebase.database().ref('discountCodes').on('value', snapshot => {
                const val = snapshot.val() || {};
                const codes = Object.values(val).sort((a, b) => {
                    if (a.createdAt && b.createdAt) {
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    }
                    return b.code.localeCompare(a.code);
                });
                let html = '';
                if (!codes.length) {
                    html = '<div style="text-align:center; padding:20px; color:#888;">No discount codes yet.</div>';
                } else {
                    html = `<div style='overflow-x:auto;'><table style='width:100%;border-collapse:collapse;background:#ecf1eb;border-radius:0;box-shadow:0 2px 12px #0003; direction:rtl;'>
                        <thead>
                            <tr style='background:#000;color:#ffb300;text-align:right;'>
                                <th style='padding:12px 10px;border-bottom:2px solid #444;'>ÿßŸÑŸÉŸàÿØ</th>
                                <th style='padding:12px 10px;border-bottom:2px solid #444;'>ŸÇŸäŸÖÿ© ÿßŸÑÿÆÿµŸÖ (ÿ¨ŸÜŸäŸá)</th>
                                <th style='padding:12px 10px;border-bottom:2px solid #444;'>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°</th>
                                <th style='padding:12px 10px;border-bottom:2px solid #444;'>ÿ≠ÿ∞ŸÅ</th>
                            </tr>
                        </thead>
                        <tbody>`;
                    codes.forEach(code => {
                        let usageInfo = '';
                        const used = code.usedCount || 0;
                        const maxUses = code.maxUses || 1;
                        const remaining = maxUses - used;

                        // Formatted like: CODE (1) ŸÖÿ™ÿ®ŸÇŸä or CODE (2) ŸÖÿ™ÿ®ŸÇŸä - (0) ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ
                        if (used > 0) {
                            usageInfo = `(${remaining}) ŸÖÿ™ÿ®ŸÇŸä - (${used}) ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ`;
                        } else {
                            usageInfo = `(${remaining}) ŸÖÿ™ÿ®ŸÇŸä`;
                        }

                        let usedColor = remaining === 0 ? '#ff4444' : '#888';

                        html += `<tr style='border-bottom:1px solid #ccc; background:#f0f0f0;'>
                            <td style='padding:10px;font-weight:bold;color:#000;'>${code.code} <span style='font-size:0.9em;color:${usedColor};font-weight:normal;'>${usageInfo}</span></td>
                            <td style='padding:10px;color:#000;'>${code.amount} ÿ¨ŸÜŸäŸá</td>
                            <td style='padding:10px;color:#000;'>${code.expires ? new Date(code.expires).toLocaleString() : ''}</td>
                            <td style='padding:10px;text-align:center;'>
                                <button onclick='deleteDiscountCode("${code.code}")' title='ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉŸàÿØ' style='background:none;border:none;cursor:pointer;'>
                                    <svg width='20' height='20' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M3 6H5H21' stroke='#ff4444' stroke-width='2'/><path d='M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M10 11V17M14 11V17' stroke='#ff4444' stroke-width='2'/></svg>
                                </button>
                            </td>
                        </tr>`;
                    });
                    html += `</tbody></table></div>`;
                }
                if (actualList) {
                    actualList.innerHTML = html;
                }
            });
        }
        function showAddDiscountCodeForm() {
            document.getElementById('discountCodesFormContainer').innerHTML = `
                <form id='addDiscountCodeForm' style='background:#232323; color:red;padding:18px 20px;border-radius:10px;margin-bottom:18px;max-width:400px;'>
                    <label>ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ (6 ÿ£ÿ≠ÿ±ŸÅ ÿ£Ÿà ÿ£ÿ±ŸÇÿßŸÖ)</label>
                    <input type='text' name='code' maxlength='6' required pattern='[A-Za-z0-9]{6}' style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <label>ŸÇŸäŸÖÿ© ÿßŸÑÿÆÿµŸÖ (ÿ¨ŸÜŸäŸá)</label>
                    <input type='number' name='amount' min='1' required style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <label>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°</label>
                    <input type='datetime-local' name='expires' required style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <label>ÿπÿØÿØ ŸÖÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ</label>
                    <input type='number' name='maxUses' min='1' value='1' required style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <button type='submit' style='background:#784fe7;color:#222;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿ≠ŸÅÿ∏ ÿßŸÑŸÉŸàÿØ</button>
                    <button type='button' onclick='hideAddDiscountCodeForm()' style='margin-right:10px;background:#333;color:#fff;'>ÿ•ŸÑÿ∫ÿßÿ°</button>
                    <div id='discountCodeError' style='color:#ff4444;font-size:1rem;margin-top:8px;'></div>
                </form>`;
            document.getElementById('addDiscountCodeForm').onsubmit = function (e) {
                e.preventDefault();
                const fd = new FormData(this);
                const code = fd.get('code').toUpperCase();
                const amount = parseInt(fd.get('amount'));
                const expires = fd.get('expires');
                const maxUses = parseInt(fd.get('maxUses')) || 1;
                if (!/^[A-Za-z0-9]{6}$/.test(code)) {
                    document.getElementById('discountCodeError').innerText = 'ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿ£Ÿà ÿ£ÿ±ŸÇÿßŸÖ.';
                    return;
                }
                if (amount <= 0) {
                    document.getElementById('discountCodeError').innerText = 'ŸÇŸäŸÖÿ© ÿßŸÑÿÆÿµŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿµŸÅÿ±.';
                    return;
                }
                if (maxUses < 1) {
                    document.getElementById('discountCodeError').innerText = 'ÿπÿØÿØ ŸÖÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 1 ÿ£Ÿà ÿ£ŸÉÿ´ÿ±.';
                    return;
                }
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿ™ŸÉÿ±ÿßÿ± ÿßŸÑŸÉŸàÿØ
                firebase.database().ref('discountCodes/' + code).once('value', snap => {
                    if (snap.exists()) {
                        document.getElementById('discountCodeError').innerText = 'Ÿáÿ∞ÿß ÿßŸÑŸÉŸàÿØ ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ.';
                        return;
                    }
                    // ÿ≠ŸÅÿ∏ ÿßŸÑŸÉŸàÿØ
                    firebase.database().ref('discountCodes/' + code).set({
                        code,
                        amount,
                        expires,
                        maxUses,
                        usedCount: 0,
                        createdBy: 'admin',
                        createdAt: new Date().toISOString()
                    }, () => {
                        hideAddDiscountCodeForm();
                    });
                });
            };
        }
        function hideAddDiscountCodeForm() {
            document.getElementById('discountCodesFormContainer').innerHTML = '';
        }
        function deleteDiscountCode(code) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖÿü')) {
                firebase.database().ref('discountCodes/' + code).remove();
            }
        }
        window.renderDiscountCodesPage = renderDiscountCodesPage;
        window.deleteDiscountCode = deleteDiscountCode;
        window.showAddDiscountCodeForm = showAddDiscountCodeForm;
        window.hideAddDiscountCodeForm = hideAddDiscountCodeForm;
    </script>
    <!-- ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ŸÖÿ±ÿ™ŸäŸÜ ÿπŸÑŸâ ÿ¥ÿπÿßÿ± icon4.png ŸÅŸä ÿßŸÑŸáŸäÿØÿ±ÿå ÿßŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var logoImg = document.querySelector('.logo img');
            if (logoImg) {
                logoImg.ondblclick = function (e) {
                    if (typeof showAdminLogin === 'function') showAdminLogin();
                };
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.navbar li[data-section]').forEach(function (li) {
                if (!li.querySelector('.shine')) {
                    var shine = document.createElement('span');
                    shine.className = 'shine';
                    li.appendChild(shine);
                }
            });
        });
    </script>
</body>

</html>